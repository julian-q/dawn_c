<!doctype html>
<html class="no-js" lang="en">
  <head><meta charset="utf-8"/>
    <meta name="viewport" content="width=device-width,initial-scale=1"/>
    <meta name="color-scheme" content="light dark"><meta name="generator" content="Docutils 0.19: https://docutils.sourceforge.io/" />
<meta property="og:title" content="Custom Extensions (🚧WIP)" />
<meta property="og:type" content="website" />
<meta property="og:url" content="https://eliemichel.github.io/appendices/custom-extensions.html" />
<meta property="og:site_name" content="Learn WebGPU for C++" />
<meta property="og:description" content="When using WebGPU in a non-Web context, there is no reason to be limited by the Web requirements. This chapter gives an overview of how to add support for new device features through WebGPU’s exten..." />
<meta property="og:image" content="https://eliemichel.github.io/images/webgpu-responsive.svg" />
<meta property="og:image:alt" content="Learn WebGPU for C++" />
<meta name="description" content="When using WebGPU in a non-Web context, there is no reason to be limited by the Web requirements. This chapter gives an overview of how to add support for new device features through WebGPU’s exten..." />
    <link rel="icon" type="image/svg+xml" href="../_static/favicon/favicon.svg">
    <link rel="icon" sizes="16x16" href="../_static/favicon/favicon-16x16.png" type="image/png">
    <link rel="icon" sizes="32x32" href="../_static/favicon/favicon-32x32.png" type="image/png">
    <link rel="apple-touch-icon" sizes="180x180" href="https://eliemichel.github.io/LearnWebGPU/_static/favicon/apple-touch-icon-180x180.png" type="image/png"><link rel="index" title="Index" href="../genindex.html" /><link rel="search" title="Search" href="../search.html" /><link rel="next" title="References (🚧WIP)" href="references.html" /><link rel="prev" title="Memory Model (🛑TODO)" href="memory-model.html" />

    <!-- Generated with Sphinx 5.3.0 and Furo 2023.03.27 -->
        <title>Custom Extensions (🚧WIP) - Learn WebGPU for C++ documentation</title>
      <link rel="stylesheet" type="text/css" href="../_static/pygments.css" />
    <link rel="stylesheet" type="text/css" href="../_static/styles/furo.css?digest=fad236701ea90a88636c2a8c73b44ae642ed2a53" />
    <link rel="stylesheet" type="text/css" href="../_static/copybutton.css" />
    <link rel="stylesheet" type="text/css" href="../_static/tabs.css" />
    <link rel="stylesheet" type="text/css" href="../_static/styles/furo-extensions.css?digest=30d1aed668e5c3a91c3e3bf6a60b675221979f0e" />
    <link rel="stylesheet" type="text/css" href="../_static/extra.css" />
    <link rel="stylesheet" type="text/css" href="../_static/sphinx_literate.css" />
    
    


<style>
  body {
    --color-code-background: #eeffcc;
  --color-code-foreground: black;
  --color-brand-primary: #ac2800;
  --color-brand-content: #007cac;
  
  }
  @media not print {
    body[data-theme="dark"] {
      --color-code-background: #272822;
  --color-code-foreground: #f8f8f2;
  --color-brand-primary: #ce5733;
  --color-brand-content: #38a6b9;
  
    }
    @media (prefers-color-scheme: dark) {
      body:not([data-theme="light"]) {
        --color-code-background: #272822;
  --color-code-foreground: #f8f8f2;
  --color-brand-primary: #ce5733;
  --color-brand-content: #38a6b9;
  
      }
    }
  }
</style></head>
  <body>
    
    <script>
      document.body.dataset.theme = localStorage.getItem("theme") || "auto";
    </script>
    

<svg xmlns="http://www.w3.org/2000/svg" style="display: none;">
  <symbol id="svg-toc" viewBox="0 0 24 24">
    <title>Contents</title>
    <svg stroke="currentColor" fill="currentColor" stroke-width="0" viewBox="0 0 1024 1024">
      <path d="M408 442h480c4.4 0 8-3.6 8-8v-56c0-4.4-3.6-8-8-8H408c-4.4 0-8 3.6-8 8v56c0 4.4 3.6 8 8 8zm-8 204c0 4.4 3.6 8 8 8h480c4.4 0 8-3.6 8-8v-56c0-4.4-3.6-8-8-8H408c-4.4 0-8 3.6-8 8v56zm504-486H120c-4.4 0-8 3.6-8 8v56c0 4.4 3.6 8 8 8h784c4.4 0 8-3.6 8-8v-56c0-4.4-3.6-8-8-8zm0 632H120c-4.4 0-8 3.6-8 8v56c0 4.4 3.6 8 8 8h784c4.4 0 8-3.6 8-8v-56c0-4.4-3.6-8-8-8zM115.4 518.9L271.7 642c5.8 4.6 14.4.5 14.4-6.9V388.9c0-7.4-8.5-11.5-14.4-6.9L115.4 505.1a8.74 8.74 0 0 0 0 13.8z"/>
    </svg>
  </symbol>
  <symbol id="svg-menu" viewBox="0 0 24 24">
    <title>Menu</title>
    <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24" fill="none" stroke="currentColor"
      stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="feather-menu">
      <line x1="3" y1="12" x2="21" y2="12"></line>
      <line x1="3" y1="6" x2="21" y2="6"></line>
      <line x1="3" y1="18" x2="21" y2="18"></line>
    </svg>
  </symbol>
  <symbol id="svg-arrow-right" viewBox="0 0 24 24">
    <title>Expand</title>
    <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24" fill="none" stroke="currentColor"
      stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="feather-chevron-right">
      <polyline points="9 18 15 12 9 6"></polyline>
    </svg>
  </symbol>
  <symbol id="svg-sun" viewBox="0 0 24 24">
    <title>Light mode</title>
    <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24" fill="none" stroke="currentColor"
      stroke-width="1.5" stroke-linecap="round" stroke-linejoin="round" class="feather-sun">
      <circle cx="12" cy="12" r="5"></circle>
      <line x1="12" y1="1" x2="12" y2="3"></line>
      <line x1="12" y1="21" x2="12" y2="23"></line>
      <line x1="4.22" y1="4.22" x2="5.64" y2="5.64"></line>
      <line x1="18.36" y1="18.36" x2="19.78" y2="19.78"></line>
      <line x1="1" y1="12" x2="3" y2="12"></line>
      <line x1="21" y1="12" x2="23" y2="12"></line>
      <line x1="4.22" y1="19.78" x2="5.64" y2="18.36"></line>
      <line x1="18.36" y1="5.64" x2="19.78" y2="4.22"></line>
    </svg>
  </symbol>
  <symbol id="svg-moon" viewBox="0 0 24 24">
    <title>Dark mode</title>
    <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24" fill="none" stroke="currentColor"
      stroke-width="1.5" stroke-linecap="round" stroke-linejoin="round" class="icon-tabler-moon">
      <path stroke="none" d="M0 0h24v24H0z" fill="none" />
      <path d="M12 3c.132 0 .263 0 .393 0a7.5 7.5 0 0 0 7.92 12.446a9 9 0 1 1 -8.313 -12.454z" />
    </svg>
  </symbol>
  <symbol id="svg-sun-half" viewBox="0 0 24 24">
    <title>Auto light/dark mode</title>
    <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24" fill="none" stroke="currentColor"
      stroke-width="1.5" stroke-linecap="round" stroke-linejoin="round" class="icon-tabler-shadow">
      <path stroke="none" d="M0 0h24v24H0z" fill="none"/>
      <circle cx="12" cy="12" r="9" />
      <path d="M13 12h5" />
      <path d="M13 15h4" />
      <path d="M13 18h1" />
      <path d="M13 9h4" />
      <path d="M13 6h1" />
    </svg>
  </symbol>
</svg>

<input type="checkbox" class="sidebar-toggle" name="__navigation" id="__navigation">
<input type="checkbox" class="sidebar-toggle" name="__toc" id="__toc">
<label class="overlay sidebar-overlay" for="__navigation">
  <div class="visually-hidden">Hide navigation sidebar</div>
</label>
<label class="overlay toc-overlay" for="__toc">
  <div class="visually-hidden">Hide table of contents sidebar</div>
</label>

<div class="announcement">
  <aside class="announcement-content">
     <em>Important</em> This documentation is a work in progress! <a href="feedback-needed.html">Feedback needed!</a> 
  </aside>
</div>

<div class="page">
  <header class="mobile-header">
    <div class="header-left">
      <label class="nav-overlay-icon" for="__navigation">
        <div class="visually-hidden">Toggle site navigation sidebar</div>
        <i class="icon"><svg><use href="#svg-menu"></use></svg></i>
      </label>
    </div>
    <div class="header-center">
      <a href="../index.html"><div class="brand">Learn WebGPU for C++  documentation</div></a>
    </div>
    <div class="header-right">
      <div class="theme-toggle-container theme-toggle-header">
        <button class="theme-toggle">
          <div class="visually-hidden">Toggle Light / Dark / Auto color theme</div>
          <svg class="theme-icon-when-auto"><use href="#svg-sun-half"></use></svg>
          <svg class="theme-icon-when-dark"><use href="#svg-moon"></use></svg>
          <svg class="theme-icon-when-light"><use href="#svg-sun"></use></svg>
        </button>
      </div>
      <label class="toc-overlay-icon toc-header-icon" for="__toc">
        <div class="visually-hidden">Toggle table of contents sidebar</div>
        <i class="icon"><svg><use href="#svg-toc"></use></svg></i>
      </label>
    </div>
  </header>
  <aside class="sidebar-drawer">
    <div class="sidebar-container">
      
      <div class="sidebar-sticky"><a class="sidebar-brand" href="../index.html">
  
  <div class="sidebar-logo-container">
    <img class="sidebar-logo only-light" src="../_static/webgpu-light.svg" alt="Light Logo"/>
    <img class="sidebar-logo only-dark" src="../_static/webgpu-dark.svg" alt="Dark Logo"/>
  </div>
  
  
</a><form class="sidebar-search-container" method="get" action="../search.html" role="search">
  <input class="sidebar-search" placeholder="Search" name="q" aria-label="Search">
  <input type="hidden" name="check_keywords" value="yes">
  <input type="hidden" name="area" value="default">
</form>
<div id="searchbox"></div><div class="sidebar-scroll"><div class="sidebar-tree">
  <ul class="current">
<li class="toctree-l1"><a class="reference internal" href="../introduction.html">Introduction</a></li>
<li class="toctree-l1 has-children"><a class="reference internal" href="../getting-started/index.html">Getting Started</a><input class="toctree-checkbox" id="toctree-checkbox-1" name="toctree-checkbox-1" role="switch" type="checkbox"/><label for="toctree-checkbox-1"><div class="visually-hidden">Toggle child pages in navigation</div><i class="icon"><svg><use href="#svg-arrow-right"></use></svg></i></label><ul>
<li class="toctree-l2"><a class="reference internal" href="../getting-started/project-setup.html">Project setup</a></li>
<li class="toctree-l2"><a class="reference internal" href="../getting-started/opening-a-window.html">Opening a window</a></li>
<li class="toctree-l2"><a class="reference internal" href="../getting-started/hello-webgpu.html">Hello WebGPU</a></li>
<li class="toctree-l2"><a class="reference internal" href="../getting-started/the-adapter.html">The Adapter</a></li>
<li class="toctree-l2"><a class="reference internal" href="../getting-started/the-device.html">The Device</a></li>
<li class="toctree-l2"><a class="reference internal" href="../getting-started/the-command-queue.html">The Command Queue</a></li>
<li class="toctree-l2"><a class="reference internal" href="../getting-started/first-color.html">First Color</a></li>
<li class="toctree-l2"><a class="reference internal" href="../getting-started/cpp-idioms.html">C++ wrapper</a></li>
</ul>
</li>
<li class="toctree-l1 has-children"><a class="reference internal" href="../basic-3d-rendering/index.html">Basic 3D Rendering</a><input class="toctree-checkbox" id="toctree-checkbox-2" name="toctree-checkbox-2" role="switch" type="checkbox"/><label for="toctree-checkbox-2"><div class="visually-hidden">Toggle child pages in navigation</div><i class="icon"><svg><use href="#svg-arrow-right"></use></svg></i></label><ul>
<li class="toctree-l2"><a class="reference internal" href="../basic-3d-rendering/hello-triangle.html">Hello Triangle</a></li>
<li class="toctree-l2 has-children"><a class="reference internal" href="../basic-3d-rendering/input-geometry/index.html">Input Geometry</a><input class="toctree-checkbox" id="toctree-checkbox-3" name="toctree-checkbox-3" role="switch" type="checkbox"/><label for="toctree-checkbox-3"><div class="visually-hidden">Toggle child pages in navigation</div><i class="icon"><svg><use href="#svg-arrow-right"></use></svg></i></label><ul>
<li class="toctree-l3"><a class="reference internal" href="../basic-3d-rendering/input-geometry/playing-with-buffers.html">Playing with buffers</a></li>
<li class="toctree-l3"><a class="reference internal" href="../basic-3d-rendering/input-geometry/a-first-vertex-attribute.html">A first Vertex Attribute</a></li>
<li class="toctree-l3"><a class="reference internal" href="../basic-3d-rendering/input-geometry/multiple-attributes.html">Multiple Attributes</a></li>
<li class="toctree-l3"><a class="reference internal" href="../basic-3d-rendering/input-geometry/index-buffer.html">Index Buffer</a></li>
<li class="toctree-l3"><a class="reference internal" href="../basic-3d-rendering/input-geometry/loading-from-file.html">Loading from file</a></li>
</ul>
</li>
<li class="toctree-l2 has-children"><a class="reference internal" href="../basic-3d-rendering/shader-uniforms/index.html">Shader Uniforms</a><input class="toctree-checkbox" id="toctree-checkbox-4" name="toctree-checkbox-4" role="switch" type="checkbox"/><label for="toctree-checkbox-4"><div class="visually-hidden">Toggle child pages in navigation</div><i class="icon"><svg><use href="#svg-arrow-right"></use></svg></i></label><ul>
<li class="toctree-l3"><a class="reference internal" href="../basic-3d-rendering/shader-uniforms/a-first-uniform.html">A first uniform</a></li>
<li class="toctree-l3"><a class="reference internal" href="../basic-3d-rendering/shader-uniforms/multiple-uniforms.html">More uniforms</a></li>
<li class="toctree-l3"><a class="reference internal" href="../basic-3d-rendering/shader-uniforms/dynamic-uniforms.html">Dynamic uniforms</a></li>
</ul>
</li>
<li class="toctree-l2 has-children"><a class="reference internal" href="../basic-3d-rendering/3d-meshes/index.html">3D Meshes</a><input class="toctree-checkbox" id="toctree-checkbox-5" name="toctree-checkbox-5" role="switch" type="checkbox"/><label for="toctree-checkbox-5"><div class="visually-hidden">Toggle child pages in navigation</div><i class="icon"><svg><use href="#svg-arrow-right"></use></svg></i></label><ul>
<li class="toctree-l3"><a class="reference internal" href="../basic-3d-rendering/3d-meshes/a-simple-example.html">A simple example</a></li>
<li class="toctree-l3"><a class="reference internal" href="../basic-3d-rendering/3d-meshes/depth-buffer.html">Depth buffer</a></li>
<li class="toctree-l3"><a class="reference internal" href="../basic-3d-rendering/3d-meshes/transformation-matrices.html">Transformation matrices</a></li>
<li class="toctree-l3"><a class="reference internal" href="../basic-3d-rendering/3d-meshes/projection-matrices.html">Projection matrices</a></li>
<li class="toctree-l3"><a class="reference internal" href="../basic-3d-rendering/3d-meshes/basic-shading.html">Basic shading</a></li>
<li class="toctree-l3"><a class="reference internal" href="../basic-3d-rendering/3d-meshes/loading-from-file.html">Loading from file</a></li>
</ul>
</li>
<li class="toctree-l2 has-children"><a class="reference internal" href="../basic-3d-rendering/texturing/index.html">Texturing</a><input class="toctree-checkbox" id="toctree-checkbox-6" name="toctree-checkbox-6" role="switch" type="checkbox"/><label for="toctree-checkbox-6"><div class="visually-hidden">Toggle child pages in navigation</div><i class="icon"><svg><use href="#svg-arrow-right"></use></svg></i></label><ul>
<li class="toctree-l3"><a class="reference internal" href="../basic-3d-rendering/texturing/a-first-texture.html">A first texture</a></li>
<li class="toctree-l3"><a class="reference internal" href="../basic-3d-rendering/texturing/texture-mapping.html">Texture mapping</a></li>
<li class="toctree-l3"><a class="reference internal" href="../basic-3d-rendering/texturing/sampler.html">Sampler</a></li>
<li class="toctree-l3"><a class="reference internal" href="../basic-3d-rendering/texturing/loading-from-file.html">Loading from file</a></li>
</ul>
</li>
<li class="toctree-l2 has-children"><a class="reference internal" href="../basic-3d-rendering/some-interaction/index.html">Some interaction</a><input class="toctree-checkbox" id="toctree-checkbox-7" name="toctree-checkbox-7" role="switch" type="checkbox"/><label for="toctree-checkbox-7"><div class="visually-hidden">Toggle child pages in navigation</div><i class="icon"><svg><use href="#svg-arrow-right"></use></svg></i></label><ul>
<li class="toctree-l3"><a class="reference internal" href="../basic-3d-rendering/some-interaction/refactoring.html">Refactoring</a></li>
<li class="toctree-l3"><a class="reference internal" href="../basic-3d-rendering/some-interaction/resizing-window.html">Resizing the window</a></li>
<li class="toctree-l3"><a class="reference internal" href="../basic-3d-rendering/some-interaction/camera-control.html">Camera control</a></li>
<li class="toctree-l3"><a class="reference internal" href="../basic-3d-rendering/some-interaction/simple-gui.html">Simple GUI</a></li>
</ul>
</li>
<li class="toctree-l2 has-children"><a class="reference internal" href="../basic-3d-rendering/lighting-and-material/index.html">Lighting and Material</a><input class="toctree-checkbox" id="toctree-checkbox-8" name="toctree-checkbox-8" role="switch" type="checkbox"/><label for="toctree-checkbox-8"><div class="visually-hidden">Toggle child pages in navigation</div><i class="icon"><svg><use href="#svg-arrow-right"></use></svg></i></label><ul>
<li class="toctree-l3"><a class="reference internal" href="../basic-3d-rendering/lighting-and-material/recap.html">Recap</a></li>
<li class="toctree-l3"><a class="reference internal" href="../basic-3d-rendering/lighting-and-material/specular.html">Specularity</a></li>
<li class="toctree-l3"><a class="reference internal" href="../basic-3d-rendering/lighting-and-material/normal-mapping.html">Normal mapping (🚧WIP)</a></li>
<li class="toctree-l3"><a class="reference internal" href="../basic-3d-rendering/lighting-and-material/ibl.html">Image-Based Lighting (🚧WIP)</a></li>
<li class="toctree-l3"><a class="reference internal" href="../basic-3d-rendering/lighting-and-material/cubemap.html">Cube Maps (🚧WIP)</a></li>
<li class="toctree-l3"><a class="reference internal" href="../basic-3d-rendering/lighting-and-material/pbr.html">Physically-Based Materials (🚧WIP)</a></li>
</ul>
</li>
</ul>
</li>
<li class="toctree-l1 has-children"><a class="reference internal" href="../basic-compute/index.html">Basic Compute</a><input class="toctree-checkbox" id="toctree-checkbox-9" name="toctree-checkbox-9" role="switch" type="checkbox"/><label for="toctree-checkbox-9"><div class="visually-hidden">Toggle child pages in navigation</div><i class="icon"><svg><use href="#svg-arrow-right"></use></svg></i></label><ul>
<li class="toctree-l2"><a class="reference internal" href="../basic-compute/compute-pipeline.html">Compute Pipeline</a></li>
<li class="toctree-l2 has-children"><a class="reference internal" href="../basic-compute/image-processing/index.html">Image Processing</a><input class="toctree-checkbox" id="toctree-checkbox-10" name="toctree-checkbox-10" role="switch" type="checkbox"/><label for="toctree-checkbox-10"><div class="visually-hidden">Toggle child pages in navigation</div><i class="icon"><svg><use href="#svg-arrow-right"></use></svg></i></label><ul>
<li class="toctree-l3"><a class="reference internal" href="../basic-compute/image-processing/mipmap-generation.html">Mipmap Generation</a></li>
<li class="toctree-l3"><a class="reference internal" href="../basic-compute/image-processing/convolution-filters.html">Convolution Filters</a></li>
<li class="toctree-l3"><a class="reference internal" href="../basic-compute/image-processing/cubemap-conversion.html">Cubemap Conversion (🚧WIP)</a></li>
<li class="toctree-l3"><a class="reference internal" href="../basic-compute/image-processing/cubemap-prefiltering.html">Cubemap Prefiltering (🚧WIP)</a></li>
</ul>
</li>
<li class="toctree-l2 has-children"><a class="reference internal" href="../basic-compute/procedural-geometry/index.html">Procedural Geometry</a><input class="toctree-checkbox" id="toctree-checkbox-11" name="toctree-checkbox-11" role="switch" type="checkbox"/><label for="toctree-checkbox-11"><div class="visually-hidden">Toggle child pages in navigation</div><i class="icon"><svg><use href="#svg-arrow-right"></use></svg></i></label><ul>
<li class="toctree-l3"><a class="reference internal" href="../basic-compute/procedural-geometry/deformation.html">Deformation (🚧WIP)</a></li>
</ul>
</li>
<li class="toctree-l2"><a class="reference internal" href="../basic-compute/neural-networks.html">Neural Networks (🛑TODO)</a></li>
</ul>
</li>
<li class="toctree-l1 has-children"><a class="reference internal" href="../advanced-techniques/index.html">Advanced Techniques</a><input class="toctree-checkbox" id="toctree-checkbox-12" name="toctree-checkbox-12" role="switch" type="checkbox"/><label for="toctree-checkbox-12"><div class="visually-hidden">Toggle child pages in navigation</div><i class="icon"><svg><use href="#svg-arrow-right"></use></svg></i></label><ul>
<li class="toctree-l2"><a class="reference internal" href="../advanced-techniques/raii.html">RAII</a></li>
<li class="toctree-l2"><a class="reference internal" href="../advanced-techniques/hdr-textures.html">High Dynamic Range Textures (🚧WIP)</a></li>
<li class="toctree-l2"><a class="reference internal" href="../advanced-techniques/deferred-shading.html">Deferred Shading (🛑TODO)</a></li>
<li class="toctree-l2"><a class="reference internal" href="../advanced-techniques/benchmarking.html">Benchmarking (🛑TODO)</a></li>
<li class="toctree-l2"><a class="reference internal" href="../advanced-techniques/render-bundles.html">Render Bundles (🛑TODO)</a></li>
<li class="toctree-l2"><a class="reference internal" href="../advanced-techniques/multi-sampling.html">Multi-Sampling (🛑TODO)</a></li>
<li class="toctree-l2"><a class="reference internal" href="../advanced-techniques/scene-tree.html">Scene tree (🛑TODO)</a></li>
<li class="toctree-l2"><a class="reference internal" href="../advanced-techniques/screen-capture.html">Screen capture (🚧WIP)</a></li>
<li class="toctree-l2"><a class="reference internal" href="../advanced-techniques/shadow-maps.html">Shadow maps (🛑TODO)</a></li>
<li class="toctree-l2"><a class="reference internal" href="../advanced-techniques/tesselation.html">Tesselation (🛑TODO)</a></li>
<li class="toctree-l2"><a class="reference internal" href="../advanced-techniques/raytracing.html">Raytracing (🛑TODO)</a></li>
</ul>
</li>
<li class="toctree-l1 current has-children"><a class="reference internal" href="index.html">Appendices</a><input checked="" class="toctree-checkbox" id="toctree-checkbox-13" name="toctree-checkbox-13" role="switch" type="checkbox"/><label for="toctree-checkbox-13"><div class="visually-hidden">Toggle child pages in navigation</div><i class="icon"><svg><use href="#svg-arrow-right"></use></svg></i></label><ul class="current">
<li class="toctree-l2"><a class="reference internal" href="teaching-native-graphics-in-2023.html">Teaching native graphics in 2023</a></li>
<li class="toctree-l2"><a class="reference internal" href="feedback-needed.html">Feedback needed</a></li>
<li class="toctree-l2"><a class="reference internal" href="debugging.html">Debugging (🚧WIP)</a></li>
<li class="toctree-l2"><a class="reference internal" href="building-for-the-web.html">Building for the Web (🚧WIP)</a></li>
<li class="toctree-l2"><a class="reference internal" href="memory-model.html">Memory Model (🛑TODO)</a></li>
<li class="toctree-l2 current current-page"><a class="current reference internal" href="custom-extensions.html#">Custom Extensions (🚧WIP)</a></li>
<li class="toctree-l2"><a class="reference internal" href="references.html">References (🚧WIP)</a></li>
<li class="toctree-l2"><a class="reference internal" href="tmp.html">Temporary page</a></li>
</ul>
</li>
</ul>

</div>
</div>

      </div>
      
    </div>
  </aside>
  <div class="main">
    <div class="content">
      <div class="article-container">
        <a href="custom-extensions.html#" class="back-to-top muted-link">
          <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24">
            <path d="M13 20h-2V8l-5.5 5.5-1.42-1.42L12 4.16l7.92 7.92-1.42 1.42L13 8v12z"></path>
          </svg>
          <span>Back to top</span>
        </a>
        <div class="content-icon-container">
          <div class="edit-this-page">
  <a class="muted-link" href="https://github.com/eliemichel/LearnWebGPU/edit/main/./appendices/custom-extensions.md" title="Edit this page">
    <svg aria-hidden="true" viewBox="0 0 24 24" stroke-width="1.5" stroke="currentColor" fill="none" stroke-linecap="round" stroke-linejoin="round">
      <path stroke="none" d="M0 0h24v24H0z" fill="none"/>
      <path d="M4 20h4l10.5 -10.5a1.5 1.5 0 0 0 -4 -4l-10.5 10.5v4" />
      <line x1="13.5" y1="6.5" x2="17.5" y2="10.5" />
    </svg>
    <span class="visually-hidden">Edit this page</span>
  </a>
</div><div class="theme-toggle-container theme-toggle-content">
            <button class="theme-toggle">
              <div class="visually-hidden">Toggle Light / Dark / Auto color theme</div>
              <svg class="theme-icon-when-auto"><use href="#svg-sun-half"></use></svg>
              <svg class="theme-icon-when-dark"><use href="#svg-moon"></use></svg>
              <svg class="theme-icon-when-light"><use href="#svg-sun"></use></svg>
            </button>
          </div>
          <label class="toc-overlay-icon toc-content-icon" for="__toc">
            <div class="visually-hidden">Toggle table of contents sidebar</div>
            <i class="icon"><svg><use href="#svg-toc"></use></svg></i>
          </label>
        </div>
        <article role="main">
          <section class="tex2jax_ignore mathjax_ignore" id="custom-extensions-wip">
<h1>Custom Extensions (🚧WIP)<a class="headerlink" href="custom-extensions.html#custom-extensions-wip" title="Permalink to this heading">#</a></h1>
<p>When using WebGPU in a non-Web context, there is no reason to be limited by the Web requirements. This chapter gives an overview of how to add support for new device features through WebGPU’s extension mechanism.</p>
<div class="admonition note">
<p class="admonition-title">Note</p>
<p>I do not use the <a class="reference external" href="https://github.com/eliemichel/WebGPU-Cpp"><code class="docutils literal notranslate"><span class="pre">webgpu.hpp</span></code></a> helper here as the extension file must define a C API. The <code class="docutils literal notranslate"><span class="pre">webgpu.hpp</span></code> wrapper can then easily be generalized to your own custom extension by using <a class="reference external" href="https://github.com/eliemichel/WebGPU-Cpp#custom-generation"><code class="docutils literal notranslate"><span class="pre">generator.py</span></code></a>.</p>
</div>
<section id="the-extension-mechanism">
<h2>The extension mechanism<a class="headerlink" href="custom-extensions.html#the-extension-mechanism" title="Permalink to this heading">#</a></h2>
<section id="descriptor-extensions">
<h3>Descriptor extensions<a class="headerlink" href="custom-extensions.html#descriptor-extensions" title="Permalink to this heading">#</a></h3>
<p>You must have noticed this <code class="docutils literal notranslate"><span class="pre">nextInChain</span></code> pointer present in all descriptors. This is a way to <strong>add extra fields to the descriptor</strong>, that may or may not be read by the backend depending on whether they recognize the extension.</p>
<section id="structure-type">
<h4>Structure type<a class="headerlink" href="custom-extensions.html#structure-type" title="Permalink to this heading">#</a></h4>
<p>When creating a new extension, we first need to pick an extension <code class="docutils literal notranslate"><span class="pre">SType</span></code> (“structure type”) identifier. This identifier can be any value that fits in a 32-bit integer, but <strong>some values are reserved</strong>. For instance, the first values correspond to official extensions:</p>
<div class="highlight-C++ notranslate"><div class="highlight"><pre><span></span><span class="c1">//</span><span class="w"> </span><span class="c1">The</span><span class="w"> </span><span class="c1">SType</span><span class="w"> </span><span class="c1">identifiers</span><span class="w"> </span><span class="c1">defined</span><span class="w"> </span><span class="c1">in</span><span class="w"> </span><span class="c1">the</span><span class="w"> </span><span class="c1">standard</span><span class="w"> </span><span class="c1">webgpu.h</span><span class="w"> </span><span class="c1">header:</span>
<span class="k">typedef</span><span class="w"> </span><span class="k">enum</span><span class="w"> </span><span class="nc">WGPUSType</span><span class="w"> </span><span class="p">{</span>
<span class="w">    </span><span class="n">WGPUSType_Invalid</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="mh">0x00000000</span><span class="p">,</span>
<span class="w">    </span><span class="n">WGPUSType_SurfaceDescriptorFromMetalLayer</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="mh">0x00000001</span><span class="p">,</span>
<span class="w">    </span><span class="n">WGPUSType_SurfaceDescriptorFromWindowsHWND</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="mh">0x00000002</span><span class="p">,</span>
<span class="w">    </span><span class="n">WGPUSType_SurfaceDescriptorFromXlibWindow</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="mh">0x00000003</span><span class="p">,</span>
<span class="w">    </span><span class="n">WGPUSType_SurfaceDescriptorFromCanvasHTMLSelector</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="mh">0x00000004</span><span class="p">,</span>
<span class="w">    </span><span class="n">WGPUSType_ShaderModuleSPIRVDescriptor</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="mh">0x00000005</span><span class="p">,</span>
<span class="w">    </span><span class="n">WGPUSType_ShaderModuleWGSLDescriptor</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="mh">0x00000006</span><span class="p">,</span>
<span class="w">    </span><span class="n">WGPUSType_PrimitiveDepthClipControl</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="mh">0x00000007</span><span class="p">,</span>
<span class="w">    </span><span class="n">WGPUSType_SurfaceDescriptorFromWaylandSurface</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="mh">0x00000008</span><span class="p">,</span>
<span class="w">    </span><span class="n">WGPUSType_SurfaceDescriptorFromAndroidNativeWindow</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="mh">0x00000009</span><span class="p">,</span>
<span class="w">    </span><span class="n">WGPUSType_SurfaceDescriptorFromXcbWindow</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="mh">0x0000000A</span><span class="p">,</span>
<span class="w">    </span><span class="n">WGPUSType_RenderPassDescriptorMaxDrawCount</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="mh">0x0000000F</span><span class="p">,</span>
<span class="w">    </span><span class="n">WGPUSType_Force32</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="mh">0x7FFFFFFF</span>
<span class="p">}</span><span class="w"> </span><span class="n">WGPUSType</span><span class="p">;</span>
</pre></div>
</div>
<p>Each backend picked its own range of values, as far as possible to avoid collisions: <code class="docutils literal notranslate"><span class="pre">wgpu-native</span></code> starts at <code class="docutils literal notranslate"><span class="pre">0x60000001</span></code> (<code class="docutils literal notranslate"><span class="pre">1610612737</span></code>) and Dawn starts at <code class="docutils literal notranslate"><span class="pre">0x000003E8</span></code> (<code class="docutils literal notranslate"><span class="pre">1000</span></code>).</p>
<div class="highlight-C++ notranslate"><div class="highlight"><pre><span></span><span class="c1">//</span><span class="w"> </span><span class="c1">Extensions</span><span class="w"> </span><span class="c1">specific</span><span class="w"> </span><span class="c1">to</span><span class="w"> </span><span class="c1">wgpu-native,</span><span class="w"> </span><span class="c1">defined</span><span class="w"> </span><span class="c1">in</span><span class="w"> </span><span class="c1">wgpu.h</span>
<span class="k">typedef</span><span class="w"> </span><span class="k">enum</span><span class="w"> </span><span class="nc">WGPUNativeSType</span><span class="w"> </span><span class="p">{</span>
<span class="w">    </span><span class="c1">//</span><span class="w"> </span><span class="c1">Start</span><span class="w"> </span><span class="c1">at</span><span class="w"> </span><span class="c1">6</span><span class="w"> </span><span class="c1">to</span><span class="w"> </span><span class="c1">prevent</span><span class="w"> </span><span class="c1">collisions</span><span class="w"> </span><span class="c1">with</span><span class="w"> </span><span class="c1">webgpu</span><span class="w"> </span><span class="c1">STypes</span>
<span class="w">    </span><span class="n">WGPUSType_DeviceExtras</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="mh">0x60000001</span><span class="p">,</span>
<span class="w">    </span><span class="n">WGPUSType_AdapterExtras</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="mh">0x60000002</span><span class="p">,</span>
<span class="w">    </span><span class="n">WGPUSType_RequiredLimitsExtras</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="mh">0x60000003</span><span class="p">,</span>
<span class="w">    </span><span class="n">WGPUSType_PipelineLayoutExtras</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="mh">0x60000004</span><span class="p">,</span>
<span class="w">    </span><span class="n">WGPUSType_ShaderModuleGLSLDescriptor</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="mh">0x60000005</span><span class="p">,</span>
<span class="w">    </span><span class="n">WGPUSType_SupportedLimitsExtras</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="mh">0x60000003</span><span class="p">,</span>
<span class="w">    </span><span class="n">WGPUSType_InstanceExtras</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="mh">0x60000006</span><span class="p">,</span>
<span class="w">    </span><span class="n">WGPUSType_SwapChainDescriptorExtras</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="mh">0x60000007</span><span class="p">,</span>
<span class="w">    </span><span class="n">WGPUNativeSType_Force32</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="mh">0x7FFFFFFF</span>
<span class="p">}</span><span class="w"> </span><span class="n">WGPUNativeSType</span><span class="p">;</span>
</pre></div>
</div>
<div class="highlight-C++ notranslate"><div class="highlight"><pre><span></span><span class="c1">//</span><span class="w"> </span><span class="c1">Dawn</span><span class="w"> </span><span class="c1">provides</span><span class="w"> </span><span class="c1">its</span><span class="w"> </span><span class="c1">extensions</span><span class="w"> </span><span class="c1">in</span><span class="w"> </span><span class="c1">its</span><span class="w"> </span><span class="c1">modified</span><span class="w"> </span><span class="c1">webgpu.h</span>
<span class="k">typedef</span><span class="w"> </span><span class="k">enum</span><span class="w"> </span><span class="nc">WGPUSType</span><span class="w"> </span><span class="p">{</span>
<span class="w">    </span><span class="n">WGPUSType_Invalid</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="mh">0x00000000</span><span class="p">,</span>
<span class="w">    </span><span class="c1">//[...]</span><span class="w"> </span><span class="c1">The</span><span class="w"> </span><span class="c1">standard</span><span class="w"> </span><span class="c1">extensions</span>
<span class="w">    </span><span class="n">WGPUSType_DawnTextureInternalUsageDescriptor</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="mh">0x000003E8</span><span class="p">,</span>
<span class="w">    </span><span class="n">WGPUSType_DawnTogglesDeviceDescriptor</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="mh">0x000003EA</span><span class="p">,</span>
<span class="w">    </span><span class="n">WGPUSType_DawnEncoderInternalUsageDescriptor</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="mh">0x000003EB</span><span class="p">,</span>
<span class="w">    </span><span class="n">WGPUSType_DawnInstanceDescriptor</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="mh">0x000003EC</span><span class="p">,</span>
<span class="w">    </span><span class="n">WGPUSType_DawnCacheDeviceDescriptor</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="mh">0x000003ED</span><span class="p">,</span>
<span class="w">    </span><span class="n">WGPUSType_DawnAdapterPropertiesPowerPreference</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="mh">0x000003EE</span><span class="p">,</span>
<span class="w">    </span><span class="n">WGPUSType_DawnBufferDescriptorErrorInfoFromWireClient</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="mh">0x000003EF</span><span class="p">,</span>
<span class="w">    </span><span class="n">WGPUSType_DawnTogglesDescriptor</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="mh">0x000003F0</span><span class="p">,</span>
<span class="w">    </span><span class="n">WGPUSType_DawnShaderModuleSPIRVOptionsDescriptor</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="mh">0x000003F1</span><span class="p">,</span>
<span class="w">    </span><span class="n">WGPUSType_Force32</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="mh">0x7FFFFFFF</span>
<span class="p">}</span><span class="w"> </span><span class="n">WGPUSType</span><span class="p">;</span>
</pre></div>
</div>
<blockquote>
<div><p>😐 How should I pick a value for my extension then?</p>
</div></blockquote>
<p>Do <strong>not</strong> use values close <strong>after the ones that already exist</strong>. Each backend and the standard header may add new values just after the ones they already use, so if you used one you will run into a <strong>collision</strong>.</p>
<p>There is no recommended range in particular yet (I guess there will eventually be more guidance but there is little feedback on this extensions mechanism for now). Just pick a base value far enough from others and sequentially add you extensions there.</p>
<p>For the sake of the example, I use <code class="docutils literal notranslate"><span class="pre">0x00001000</span></code> (<code class="docutils literal notranslate"><span class="pre">4096</span></code>). In a custom <code class="docutils literal notranslate"><span class="pre">webgpu-ext-foo.h</span></code> I define my extension <code class="docutils literal notranslate"><span class="pre">SType</span></code>. To introduce our new feature “Foo” we may need to add extension to multiple descriptors.</p>
<div class="highlight-C++ notranslate"><div class="highlight"><pre><span></span><span class="c1">//</span><span class="w"> </span><span class="c1">In</span><span class="w"> </span><span class="c1">file</span><span class="w"> </span><span class="c1">webgpu-ext-foo.h</span><span class="w"> </span><span class="c1">we</span><span class="w"> </span><span class="c1">define</span><span class="w"> </span><span class="c1">the</span><span class="w"> </span><span class="c1">API</span><span class="w"> </span><span class="c1">of</span><span class="w"> </span><span class="c1">our</span><span class="w"> </span><span class="c1">extension</span><span class="w"> </span><span class="c1">&quot;Foo&quot;</span>

<span class="c1">//</span><span class="w"> </span><span class="c1">We</span><span class="w"> </span><span class="c1">give</span><span class="w"> </span><span class="c1">our</span><span class="w"> </span><span class="c1">enum</span><span class="w"> </span><span class="c1">a</span><span class="w"> </span><span class="c1">name</span><span class="w"> </span><span class="c1">that</span><span class="w"> </span><span class="c1">is</span><span class="w"> </span><span class="c1">a</span><span class="w"> </span><span class="c1">variant</span><span class="w"> </span><span class="c1">of</span><span class="w"> </span><span class="c1">WGPUSType</span>
<span class="k">typedef</span><span class="w"> </span><span class="k">enum</span><span class="w"> </span><span class="nc">WGPUFooSType</span><span class="w"> </span><span class="p">{</span>
<span class="w">    </span><span class="c1">//</span><span class="w"> </span><span class="c1">Our</span><span class="w"> </span><span class="c1">new</span><span class="w"> </span><span class="c1">extension,</span><span class="w"> </span><span class="c1">for</span><span class="w"> </span><span class="c1">instance</span><span class="w"> </span><span class="c1">to</span><span class="w"> </span><span class="c1">extend</span><span class="w"> </span><span class="c1">the</span><span class="w"> </span><span class="c1">Render</span><span class="w"> </span><span class="c1">Pipeline</span>
<span class="w">    </span><span class="n">WGPUFooSType_FooRenderPipelineDescriptor</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="mh">0x00001001</span><span class="p">,</span>

<span class="w">    </span><span class="c1">//</span><span class="w"> </span><span class="c1">Force</span><span class="w"> </span><span class="c1">the</span><span class="w"> </span><span class="c1">enum</span><span class="w"> </span><span class="c1">value</span><span class="w"> </span><span class="c1">to</span><span class="w"> </span><span class="c1">be</span><span class="w"> </span><span class="c1">represented</span><span class="w"> </span><span class="c1">on</span><span class="w"> </span><span class="c1">32-bit</span><span class="w"> </span><span class="c1">integers</span>
<span class="w">    </span><span class="n">WGPUFooSType_Force32</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="mh">0x7FFFFFFF</span>
<span class="p">}</span><span class="w"> </span><span class="n">WGPUFooSType</span><span class="p">;</span><span class="w"> </span><span class="c1">//</span><span class="w"> </span><span class="c1">(set</span><span class="w"> </span><span class="c1">enum</span><span class="w"> </span><span class="c1">name</span><span class="w"> </span><span class="c1">here</span><span class="w"> </span><span class="c1">as</span><span class="w"> </span><span class="c1">well)</span>
</pre></div>
</div>
<div class="admonition important">
<p class="admonition-title">Important</p>
<p>Do not forget the <code class="docutils literal notranslate"><span class="pre">WGPUNativeSType_Force32</span> <span class="pre">=</span> <span class="pre">0x7FFFFFFF</span></code>, which is used to ensure that the C++ compiler does not optimize the representation of the enum’s value on less than 32 bits.</p>
</div>
</section>
<section id="structure-fields">
<h4>Structure fields<a class="headerlink" href="custom-extensions.html#structure-fields" title="Permalink to this heading">#</a></h4>
<p>Let us follow the logic of the WebGPU device when it receives a descriptor:</p>
<ol class="arabic simple">
<li><p>Look at <code class="docutils literal notranslate"><span class="pre">nextInChain</span></code> if it is not null. This has type <code class="docutils literal notranslate"><span class="pre">WGPUChainedStructOut</span></code>, which means its first field is another chain pointer <code class="docutils literal notranslate"><span class="pre">next</span></code>, and its second field is an integer called <code class="docutils literal notranslate"><span class="pre">sType</span></code>.</p></li>
<li><p>Look at the value <code class="docutils literal notranslate"><span class="pre">nextInChain-&gt;sType</span></code> and check that it knows this value.</p></li>
<li><p>If it does know it, the device is aware that <code class="docutils literal notranslate"><span class="pre">nextInChain</span></code> actually point to a structure that is <strong>more than just</strong> <code class="docutils literal notranslate"><span class="pre">WGPUChainedStructOut</span></code>, but instead a structure that starts in the same way but has <strong>extra fields</strong>.</p></li>
<li><p>The device <strong>casts</strong> <code class="docutils literal notranslate"><span class="pre">nextInChain</span></code> to this known structure and reads the extra fields.</p></li>
<li><p>Repeat from step 1. by replacing <code class="docutils literal notranslate"><span class="pre">nextInChain</span></code> by <code class="docutils literal notranslate"><span class="pre">nextInChain-&gt;next</span></code>.</p></li>
</ol>
<p>The heart of the extension lies in step 3. Our extension must provide the definition of this structure that starts like a <code class="docutils literal notranslate"><span class="pre">WGPUChainedStructOut</span></code>, that both the user code and the backend code agree on.</p>
<p>To start like <code class="docutils literal notranslate"><span class="pre">WGPUChainedStructOut</span></code>, we use the C-idiomatic inheritance mechanism: have <strong>the first attribute</strong> of your struct be of type <code class="docutils literal notranslate"><span class="pre">WGPUChainedStructOut</span></code>. This ensure that an instance of your struct can be cast to a <code class="docutils literal notranslate"><span class="pre">WGPUChainedStructOut</span></code>:</p>
<div class="highlight-C++ notranslate"><div class="highlight"><pre><span></span><span class="c1">//</span><span class="w"> </span><span class="c1">In</span><span class="w"> </span><span class="c1">file</span><span class="w"> </span><span class="c1">webgpu-ext-foo.h</span>
<span class="k">typedef</span><span class="w"> </span><span class="k">struct</span><span class="w"> </span><span class="nc">WGPUFooRenderPipelineDescriptor</span><span class="w"> </span><span class="p">{</span>
<span class="w">    </span><span class="c1">//</span><span class="w"> </span><span class="c1">This</span><span class="w"> </span><span class="c1">first</span><span class="w"> </span><span class="c1">field</span><span class="w"> </span><span class="c1">is</span><span class="w"> </span><span class="c1">conventionally</span><span class="w"> </span><span class="c1">called</span><span class="w"> </span><span class="c1">&#39;chain&#39;</span>
<span class="w">    </span><span class="n">WGPUChainedStructOut</span><span class="w"> </span><span class="n">chain</span><span class="p">;</span>

<span class="w">    </span><span class="c1">//</span><span class="w"> </span><span class="c1">Your</span><span class="w"> </span><span class="c1">custom</span><span class="w"> </span><span class="c1">fields</span><span class="w"> </span><span class="c1">here</span>
<span class="w">    </span><span class="kt">uint32_t</span><span class="w"> </span><span class="n">foo</span><span class="p">;</span>
<span class="p">}</span><span class="w"> </span><span class="n">WGPUFooRenderPipelineDescriptor</span><span class="p">;</span>
</pre></div>
</div>
<p>In the end user code, this would be used as follows:</p>
<div class="highlight-C++ notranslate"><div class="highlight"><pre><span></span><span class="n">WGPUFooRenderPipelineDescriptor</span><span class="w"> </span><span class="n">fooDesc</span><span class="p">;</span>
<span class="c1">//</span><span class="w"> </span><span class="c1">Set</span><span class="w"> </span><span class="c1">next</span><span class="w"> </span><span class="c1">to</span><span class="w"> </span><span class="c1">NULL</span><span class="w"> </span><span class="c1">or</span><span class="w"> </span><span class="c1">whatever</span><span class="w"> </span><span class="c1">else</span><span class="w"> </span><span class="c1">if</span><span class="w"> </span><span class="c1">you</span><span class="w"> </span><span class="c1">use</span><span class="w"> </span><span class="c1">other</span><span class="w"> </span><span class="c1">extensions</span><span class="w"> </span><span class="c1">as</span><span class="w"> </span><span class="c1">well</span>
<span class="n">fooDesc</span><span class="p">.</span><span class="n">chain</span><span class="p">.</span><span class="n">next</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nb">NULL</span><span class="p">;</span>

<span class="c1">//</span><span class="w"> </span><span class="c1">Always</span><span class="w"> </span><span class="c1">set</span><span class="w"> </span><span class="c1">this</span><span class="w"> </span><span class="c1">to</span><span class="w"> </span><span class="c1">WGPUSType_FooRenderPipelineDescriptor</span><span class="w"> </span><span class="c1">when</span><span class="w"> </span><span class="c1">the</span><span class="w"> </span><span class="c1">struct</span><span class="w"> </span><span class="c1">that</span>
<span class="c1">//</span><span class="w"> </span><span class="c1">contains</span><span class="w"> </span><span class="c1">the</span><span class="w"> </span><span class="c1">&quot;chain&quot;</span><span class="w"> </span><span class="c1">field</span><span class="w"> </span><span class="c1">has</span><span class="w"> </span><span class="c1">actually</span><span class="w"> </span><span class="c1">type</span><span class="w"> </span><span class="c1">WGPUFooRenderPipelineDescriptor.</span>
<span class="n">fooDesc</span><span class="p">.</span><span class="n">chain</span><span class="p">.</span><span class="n">sType</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">WGPUSType_FooRenderPipelineDescriptor</span><span class="p">;</span>

<span class="c1">//</span><span class="w"> </span><span class="c1">Set</span><span class="w"> </span><span class="c1">Foo</span><span class="w"> </span><span class="c1">description</span><span class="w"> </span><span class="c1">fields</span>
<span class="n">fooDesc</span><span class="p">.</span><span class="n">foo</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="mi">0</span><span class="p">;</span>

<span class="c1">//</span><span class="w"> </span><span class="c1">Use</span><span class="w"> </span><span class="c1">in</span><span class="w"> </span><span class="c1">the</span><span class="w"> </span><span class="c1">nextInChain</span><span class="w"> </span><span class="c1">of</span><span class="w"> </span><span class="c1">the</span><span class="w"> </span><span class="c1">standard</span><span class="w"> </span><span class="c1">descriptor</span><span class="w"> </span><span class="c1">it</span><span class="w"> </span><span class="c1">targets</span>
<span class="n">WGPURenderPipelineDescriptor</span><span class="w"> </span><span class="n">desc</span><span class="p">;</span>
<span class="n">desc</span><span class="p">.</span><span class="n">nextInChain</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="o">&amp;</span><span class="n">fooDesc</span><span class="p">.</span><span class="n">chain</span><span class="p">;</span>
</pre></div>
</div>
</section>
</section>
<section id="adapter-features">
<h3>Adapter features<a class="headerlink" href="custom-extensions.html#adapter-features" title="Permalink to this heading">#</a></h3>
<p>When introducing a new extension, we must advertise its availability to the user code by adding a new <strong>feature</strong> in the adapter. Thus at startup when checking adapter capabilities the end user code can figure out whether it is allowed to use the extension of not.</p>
<p>The logic is very similar to <code class="docutils literal notranslate"><span class="pre">SType</span></code>: there are standard ones, and backend-specific ones starting at the same indices than STypes.</p>
<div class="highlight-C++ notranslate"><div class="highlight"><pre><span></span><span class="c1">//</span><span class="w"> </span><span class="c1">Standard</span><span class="w"> </span><span class="c1">adapter</span><span class="w"> </span><span class="c1">features</span>
<span class="k">typedef</span><span class="w"> </span><span class="k">enum</span><span class="w"> </span><span class="nc">WGPUFeatureName</span><span class="w"> </span><span class="p">{</span>
<span class="w">    </span><span class="n">WGPUFeatureName_Undefined</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="mh">0x00000000</span><span class="p">,</span>
<span class="w">    </span><span class="n">WGPUFeatureName_DepthClipControl</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="mh">0x00000001</span><span class="p">,</span>
<span class="w">    </span><span class="n">WGPUFeatureName_Depth32FloatStencil8</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="mh">0x00000002</span><span class="p">,</span>
<span class="w">    </span><span class="n">WGPUFeatureName_TimestampQuery</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="mh">0x00000003</span><span class="p">,</span>
<span class="w">    </span><span class="c1">//</span><span class="w"> </span><span class="c1">[...]</span>
<span class="w">    </span><span class="n">WGPUFeatureName_Force32</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="mh">0x7FFFFFFF</span>
<span class="p">}</span><span class="w"> </span><span class="n">WGPUFeatureName</span><span class="p">;</span>
</pre></div>
</div>
<div class="highlight-C++ notranslate"><div class="highlight"><pre><span></span><span class="c1">//</span><span class="w"> </span><span class="c1">Here</span><span class="w"> </span><span class="c1">is</span><span class="w"> </span><span class="c1">wgpu-native&#39;s</span><span class="w"> </span><span class="c1">wgpu.h</span>
<span class="k">typedef</span><span class="w"> </span><span class="k">enum</span><span class="w"> </span><span class="nc">WGPUNativeFeature</span><span class="w"> </span><span class="p">{</span>
<span class="w">    </span><span class="n">WGPUNativeFeature_PushConstants</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="mh">0x60000001</span><span class="p">,</span>
<span class="w">    </span><span class="n">WGPUNativeFeature_TextureAdapterSpecificFormatFeatures</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="mh">0x60000002</span><span class="p">,</span>
<span class="w">    </span><span class="n">WGPUNativeFeature_MultiDrawIndirect</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="mh">0x60000003</span><span class="p">,</span>
<span class="w">    </span><span class="n">WGPUNativeFeature_MultiDrawIndirectCount</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="mh">0x60000004</span><span class="p">,</span>
<span class="w">    </span><span class="n">WGPUNativeFeature_VertexWritableStorage</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="mh">0x60000005</span><span class="p">,</span>
<span class="w">    </span><span class="n">WGPUNativeFeature_Force32</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="mh">0x7FFFFFFF</span>
<span class="p">}</span><span class="w"> </span><span class="n">WGPUNativeFeature</span><span class="p">;</span>
</pre></div>
</div>
<div class="highlight-C++ notranslate"><div class="highlight"><pre><span></span><span class="c1">//</span><span class="w"> </span><span class="c1">And</span><span class="w"> </span><span class="c1">here</span><span class="w"> </span><span class="c1">are</span><span class="w"> </span><span class="c1">Dawn</span><span class="w"> </span><span class="c1">features.</span>
<span class="k">typedef</span><span class="w"> </span><span class="k">enum</span><span class="w"> </span><span class="nc">WGPUFeatureName</span><span class="w"> </span><span class="p">{</span>
<span class="w">    </span><span class="n">WGPUFeatureName_Undefined</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="mh">0x00000000</span><span class="p">,</span>
<span class="w">    </span><span class="c1">//</span><span class="w"> </span><span class="c1">[...]</span><span class="w"> </span><span class="c1">The</span><span class="w"> </span><span class="c1">standard</span><span class="w"> </span><span class="c1">feature</span><span class="w"> </span><span class="c1">names</span>
<span class="w">    </span><span class="n">WGPUFeatureName_DawnShaderFloat16</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="mh">0x000003E9</span><span class="p">,</span>
<span class="w">    </span><span class="n">WGPUFeatureName_DawnInternalUsages</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="mh">0x000003EA</span><span class="p">,</span>
<span class="w">    </span><span class="n">WGPUFeatureName_DawnMultiPlanarFormats</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="mh">0x000003EB</span><span class="p">,</span>
<span class="w">    </span><span class="n">WGPUFeatureName_DawnNative</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="mh">0x000003EC</span><span class="p">,</span>
<span class="w">    </span><span class="n">WGPUFeatureName_ChromiumExperimentalDp4a</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="mh">0x000003ED</span><span class="p">,</span>
<span class="w">    </span><span class="n">WGPUFeatureName_TimestampQueryInsidePasses</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="mh">0x000003EE</span><span class="p">,</span>
<span class="w">    </span><span class="n">WGPUFeatureName_ImplicitDeviceSynchronization</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="mh">0x000003EF</span><span class="p">,</span>
<span class="w">    </span><span class="n">WGPUFeatureName_Force32</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="mh">0x7FFFFFFF</span>
<span class="p">}</span><span class="w"> </span><span class="n">WGPUFeatureName</span><span class="p">;</span>
</pre></div>
</div>
<p>We can add our own “Foo” feature, still in our <code class="docutils literal notranslate"><span class="pre">webgpu-ext-foo.h</span></code> file:</p>
<div class="highlight-C++ notranslate"><div class="highlight"><pre><span></span><span class="c1">//</span><span class="w"> </span><span class="c1">We</span><span class="w"> </span><span class="c1">give</span><span class="w"> </span><span class="c1">our</span><span class="w"> </span><span class="c1">enum</span><span class="w"> </span><span class="c1">a</span><span class="w"> </span><span class="c1">name</span><span class="w"> </span><span class="c1">that</span><span class="w"> </span><span class="c1">is</span><span class="w"> </span><span class="c1">a</span><span class="w"> </span><span class="c1">variant</span><span class="w"> </span><span class="c1">of</span><span class="w"> </span><span class="c1">WGPUFeatureName</span>
<span class="k">typedef</span><span class="w"> </span><span class="k">enum</span><span class="w"> </span><span class="nc">WGPUFooFeatureName</span><span class="w"> </span><span class="p">{</span>
<span class="w">    </span><span class="c1">//</span><span class="w"> </span><span class="c1">Our</span><span class="w"> </span><span class="c1">new</span><span class="w"> </span><span class="c1">feature</span><span class="w"> </span><span class="c1">name</span>
<span class="w">    </span><span class="n">WGPUFooFeatureName_Foo</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="mh">0x00001001</span><span class="p">,</span>

<span class="w">    </span><span class="c1">//</span><span class="w"> </span><span class="c1">Force</span><span class="w"> </span><span class="c1">the</span><span class="w"> </span><span class="c1">enum</span><span class="w"> </span><span class="c1">value</span><span class="w"> </span><span class="c1">to</span><span class="w"> </span><span class="c1">be</span><span class="w"> </span><span class="c1">represented</span><span class="w"> </span><span class="c1">on</span><span class="w"> </span><span class="c1">32-bit</span><span class="w"> </span><span class="c1">integers</span>
<span class="w">    </span><span class="n">WGPUFooFeatureName_Force32</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="mh">0x7FFFFFFF</span>
<span class="p">}</span><span class="w"> </span><span class="n">WGPUFooFeatureName</span><span class="p">;</span><span class="w"> </span><span class="c1">//</span><span class="w"> </span><span class="c1">(set</span><span class="w"> </span><span class="c1">enum</span><span class="w"> </span><span class="c1">name</span><span class="w"> </span><span class="c1">here</span><span class="w"> </span><span class="c1">as</span><span class="w"> </span><span class="c1">well)</span>
</pre></div>
</div>
<p>The <code class="docutils literal notranslate"><span class="pre">webgpu-ext-foo.h</span></code> file that we have is all we need as an interface between the user code and our modified backend. For the implementation of this header, we need to chose what backend to edit.</p>
</section>
</section>
<section id="with-wgpu-native">
<h2>With <code class="docutils literal notranslate"><span class="pre">wgpu-native</span></code><a class="headerlink" href="custom-extensions.html#with-wgpu-native" title="Permalink to this heading">#</a></h2>
<section id="building-wgpu-native">
<h3>Building <code class="docutils literal notranslate"><span class="pre">wgpu-native</span></code><a class="headerlink" href="custom-extensions.html#building-wgpu-native" title="Permalink to this heading">#</a></h3>
<p>Start by building a “regular” <code class="docutils literal notranslate"><span class="pre">wgpu-native</span></code> using <a class="reference external" href="https://github.com/gfx-rs/wgpu-native/wiki/Getting-Started">the instructions from their repository</a>. You need in particular <a class="reference external" href="https://www.rust-lang.org/">rust</a> and <a class="reference external" href="https://rust-lang.github.io/rust-bindgen/requirements.html">LLVM/Clang</a>. With these installed, building looks like this:</p>
<div class="highlight-bash notranslate"><div class="highlight"><pre><span></span>git<span class="w"> </span>clone<span class="w"> </span>--recurse-submodules<span class="w"> </span>https://github.com/gfx-rs/wgpu-native
<span class="nb">cd</span><span class="w"> </span>wgpu-native
<span class="nb">set</span><span class="w"> </span><span class="nv">LIBCLANG_PATH</span><span class="o">=</span>E:/Libraries/libclang/bin
cargo<span class="w"> </span>build<span class="w"> </span>--release
</pre></div>
</div>
<p>You then find the binaries in <code class="docutils literal notranslate"><span class="pre">target\release</span></code>. If you use the <code class="docutils literal notranslate"><span class="pre">wgpu-native</span></code> based <a class="reference external" href="https://github.com/eliemichel/WebGPU-distribution/tree/wgpu">WebGPU-distribution</a> in your end project, simply replace the relevant files in <code class="docutils literal notranslate"><span class="pre">webgpu/bin</span></code>.</p>
</section>
<section id="building-wgpu">
<h3>Building <code class="docutils literal notranslate"><span class="pre">wgpu</span></code><a class="headerlink" href="custom-extensions.html#building-wgpu" title="Permalink to this heading">#</a></h3>
<p>The <code class="docutils literal notranslate"><span class="pre">wgpu-native</span></code> repository is a thin layer exposing as a C interface the actual <code class="docutils literal notranslate"><span class="pre">wgpu</span></code> backend. When creating a custom extension, we need to change the backend, and instruct the <code class="docutils literal notranslate"><span class="pre">wgpu-native</span></code> layer to use our custom <code class="docutils literal notranslate"><span class="pre">wgpu</span></code> branch.</p>
<div class="highlight-bash notranslate"><div class="highlight"><pre><span></span>git<span class="w"> </span>clone<span class="w"> </span>https://github.com/gfx-rs/wgpu
<span class="nb">cd</span><span class="w"> </span>wgpu
cargo<span class="w"> </span>build<span class="w"> </span>--release
</pre></div>
</div>
<p>To point <code class="docutils literal notranslate"><span class="pre">wgpu-native</span></code> to our custom <code class="docutils literal notranslate"><span class="pre">wgpu</span></code>, we can modify its <code class="docutils literal notranslate"><span class="pre">Cargo.toml</span></code> and add:</p>
<div class="highlight-toml notranslate"><div class="highlight"><pre><span></span><span class="k">[patch.&quot;https://github.com/gfx-rs/wgpu&quot;]</span>
<span class="n">wgpu-core</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="p">{</span><span class="w"> </span><span class="n">path</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="s">&quot;../wgpu/wgpu-core&quot;</span><span class="w"> </span><span class="p">}</span>
<span class="n">wgpu-types</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="p">{</span><span class="w"> </span><span class="n">path</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="s">&quot;../wgpu/wgpu-types&quot;</span><span class="w"> </span><span class="p">}</span>
</pre></div>
</div>
<div class="admonition note">
<p class="admonition-title">Note</p>
<p>To make sure to reproduce the very same binaries, check out in the <code class="docutils literal notranslate"><span class="pre">wgpu</span></code> directory the commit specified after <code class="docutils literal notranslate"><span class="pre">rev</span> <span class="pre">=</span></code> in the <code class="docutils literal notranslate"><span class="pre">Cargo.toml</span></code> of <code class="docutils literal notranslate"><span class="pre">wgpu-native</span></code>.</p>
<div class="highlight-bash notranslate"><div class="highlight"><pre><span></span><span class="nb">cd</span><span class="w"> </span>wgpu
git<span class="w"> </span>checkout<span class="w"> </span>011a4e26d04f388ef40e3baee3f19a255b9b5148
</pre></div>
</div>
<p>But since you are writing an extension you may want to use the last version of <code class="docutils literal notranslate"><span class="pre">wgpu</span></code> instead.</p>
</div>
</section>
<section id="extending-types">
<h3>Extending types<a class="headerlink" href="custom-extensions.html#extending-types" title="Permalink to this heading">#</a></h3>
<p>We can copy our <code class="docutils literal notranslate"><span class="pre">webgpu-ext-foo.h</span></code> header in the <code class="docutils literal notranslate"><span class="pre">wgpu-native/ffi/</span></code> directory, next to <code class="docutils literal notranslate"><span class="pre">wgpu.h</span></code>. In order to have rust’s build system parse these files, we add our custom header to <code class="docutils literal notranslate"><span class="pre">build.rs</span></code>:</p>
<div class="highlight-rust notranslate"><div class="highlight"><pre><span></span><span class="kd">let</span><span class="w"> </span><span class="k">mut</span><span class="w"> </span><span class="n">builder</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">bindgen</span>::<span class="n">Builder</span>::<span class="n">default</span><span class="p">()</span>
<span class="w">    </span><span class="p">.</span><span class="n">header</span><span class="p">(</span><span class="s">&quot;ffi/webgpu-headers/webgpu.h&quot;</span><span class="p">)</span>
<span class="w">    </span><span class="p">.</span><span class="n">header</span><span class="p">(</span><span class="s">&quot;ffi/wgpu.h&quot;</span><span class="p">)</span>
<span class="w">    </span><span class="p">.</span><span class="n">header</span><span class="p">(</span><span class="s">&quot;ffi/webgpu-ext-foo.h&quot;</span><span class="p">)</span><span class="w"> </span><span class="c1">//</span><span class="w"> </span><span class="c1">&lt;--</span><span class="w"> </span><span class="c1">Here</span><span class="w"> </span><span class="c1">is</span><span class="w"> </span><span class="c1">our</span><span class="w"> </span><span class="c1">custom</span><span class="w"> </span><span class="c1">file</span>
<span class="w">    </span><span class="c1">//</span><span class="w"> </span><span class="c1">[...]</span>
</pre></div>
</div>
<p>This defines in rust’s <code class="docutils literal notranslate"><span class="pre">native</span></code> namespace symbols that are equivalent to what the C header files expose. We must also modify some existing types in <code class="docutils literal notranslate"><span class="pre">wgpu-types/src/lib.rs</span></code>. At least to add our new adapter feature:</p>
<div class="highlight-rust notranslate"><div class="highlight"><pre><span></span><span class="n">bitflags</span>::<span class="n">bitflags</span><span class="o">!</span><span class="w"> </span><span class="p">{</span>
<span class="w">    </span><span class="c1">//</span><span class="w"> </span><span class="c1">[...]</span>
<span class="w">    </span><span class="k">pub</span><span class="w"> </span><span class="k">struct</span><span class="w"> </span><span class="nc">Features</span>:<span class="w"> </span><span class="kt">u64</span><span class="w"> </span><span class="p">{</span>
<span class="w">        </span><span class="c1">//</span><span class="w"> </span><span class="c1">[...]</span>
<span class="w">        </span><span class="k">const</span><span class="w"> </span><span class="n">SHADER_EARLY_DEPTH_TEST</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="mi">1</span><span class="w"> </span><span class="o">&lt;&lt;</span><span class="w"> </span><span class="mi">62</span><span class="p">;</span>

<span class="w">        </span><span class="c1">//</span><span class="w"> </span><span class="c1">Our</span><span class="w"> </span><span class="c1">feature</span><span class="w"> </span><span class="c1">as</span><span class="w"> </span><span class="c1">a</span><span class="w"> </span><span class="c1">bitflag</span>
<span class="w">        </span><span class="k">const</span><span class="w"> </span><span class="n">FOO</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="mi">1</span><span class="w"> </span><span class="o">&lt;&lt;</span><span class="w"> </span><span class="mi">63</span><span class="p">;</span>
<span class="w">    </span><span class="p">}</span>
<span class="p">}</span>
</pre></div>
</div>
<p>In our running example, we want to add a field <code class="docutils literal notranslate"><span class="pre">foo</span></code> to the render pipeline. We thus modify the <code class="docutils literal notranslate"><span class="pre">RenderPipelineDescriptor</span></code> in <code class="docutils literal notranslate"><span class="pre">wgpu/wgpu-core/src/pipeline.rs</span></code>:</p>
<div class="highlight-rust notranslate"><div class="highlight"><pre><span></span><span class="k">pub</span><span class="w"> </span><span class="k">struct</span><span class="w"> </span><span class="nc">RenderPipelineDescriptor</span><span class="o">&lt;&#39;</span><span class="na">a</span><span class="o">&gt;</span><span class="w"> </span><span class="p">{</span>
<span class="w">    </span><span class="c1">//</span><span class="w"> </span><span class="c1">[...]</span>
<span class="w">    </span><span class="sd">///</span><span class="w"> </span><span class="sd">our</span><span class="w"> </span><span class="sd">custom</span><span class="w"> </span><span class="sd">new</span><span class="w"> </span><span class="sd">field</span>
<span class="w">    </span><span class="k">pub</span><span class="w"> </span><span class="n">foo</span>:<span class="w"> </span><span class="nb">Option</span><span class="o">&lt;</span><span class="kt">u32</span><span class="o">&gt;</span><span class="p">,</span>
<span class="p">}</span>
</pre></div>
</div>
</section>
<section id="extending-core">
<h3>Extending core<a class="headerlink" href="custom-extensions.html#extending-core" title="Permalink to this heading">#</a></h3>
<p>If your extension is shallow enough not to affect the backends, you should only have to modify <code class="docutils literal notranslate"><span class="pre">wgpu/wgpu-core</span></code>. But if you take the time to write a custom extension, it likely requires to modify one or multiple backends.</p>
<p>Conversion utilities to link rust-side types defined in <code class="docutils literal notranslate"><span class="pre">wgpu/wgpu-types</span></code> with the <code class="docutils literal notranslate"><span class="pre">native</span></code> defines that follow the C header. Add your feature name to <code class="docutils literal notranslate"><span class="pre">features_to_native</span></code> and <code class="docutils literal notranslate"><span class="pre">map_feature</span></code>:</p>
<div class="highlight-rust notranslate"><div class="highlight"><pre><span></span><span class="k">pub</span><span class="w"> </span><span class="k">fn</span><span class="w"> </span><span class="nf">features_to_native</span><span class="p">(</span><span class="n">features</span>:<span class="w"> </span><span class="nc">wgt</span>::<span class="n">Features</span><span class="p">)</span><span class="w"> </span>-&gt;<span class="w"> </span><span class="nb">Vec</span><span class="o">&lt;</span><span class="n">native</span>::<span class="n">WGPUFeatureName</span><span class="o">&gt;</span><span class="w"> </span><span class="p">{</span>
<span class="w">    </span><span class="c1">//</span><span class="w"> </span><span class="c1">[...]</span>
<span class="w">    </span><span class="k">if</span><span class="w"> </span><span class="n">features</span><span class="p">.</span><span class="n">contains</span><span class="p">(</span><span class="n">wgt</span>::<span class="n">Features</span>::<span class="n">FOO</span><span class="p">)</span><span class="w"> </span><span class="p">{</span>
<span class="w">        </span><span class="n">temp</span><span class="p">.</span><span class="n">push</span><span class="p">(</span><span class="n">native</span>::<span class="n">WGPUFeatureName_Foo</span><span class="p">);</span>
<span class="w">    </span><span class="p">}</span>
<span class="w">    </span><span class="n">temp</span>
<span class="p">}</span>

<span class="k">pub</span><span class="w"> </span><span class="k">fn</span><span class="w"> </span><span class="nf">map_feature</span><span class="p">(</span><span class="n">feature</span>:<span class="w"> </span><span class="nc">native</span>::<span class="n">WGPUFeatureName</span><span class="p">)</span><span class="w"> </span>-&gt;<span class="w"> </span><span class="nb">Option</span><span class="o">&lt;</span><span class="n">wgt</span>::<span class="n">Features</span><span class="o">&gt;</span><span class="w"> </span><span class="p">{</span>
<span class="w">    </span><span class="k">use</span><span class="w"> </span><span class="n">wgt</span>::<span class="n">Features</span><span class="p">;</span>
<span class="w">    </span><span class="k">match</span><span class="w"> </span><span class="n">feature</span><span class="w"> </span><span class="p">{</span>
<span class="w">        </span><span class="c1">//</span><span class="w"> </span><span class="c1">[...]</span>
<span class="w">        </span><span class="n">native</span>::<span class="n">WGPUFeatureName_Foo</span><span class="w"> </span><span class="o">=&gt;</span><span class="w"> </span><span class="nb">Some</span><span class="p">(</span><span class="n">Features</span>::<span class="n">FOO</span><span class="p">),</span>
<span class="w">        </span><span class="c1">//</span><span class="w"> </span><span class="c1">[...]</span>
<span class="w">    </span><span class="p">}</span>
<span class="p">}</span>
</pre></div>
</div>
<p>In order to recognize our <code class="docutils literal notranslate"><span class="pre">SType</span></code> when it is passed in the extension chain of a <code class="docutils literal notranslate"><span class="pre">RenderPipelineDescriptor</span></code>, we modify the <code class="docutils literal notranslate"><span class="pre">wgpuDeviceCreateRenderPipeline</span></code> procedure in <code class="docutils literal notranslate"><span class="pre">wgpu-native/src/device.rs</span></code>:</p>
<div class="highlight-rust notranslate"><div class="highlight"><pre><span></span><span class="k">pub</span><span class="w"> </span><span class="k">unsafe</span><span class="w"> </span><span class="k">extern</span><span class="w"> </span><span class="s">&quot;C&quot;</span><span class="w"> </span><span class="k">fn</span><span class="w"> </span><span class="nf">wgpuDeviceCreateRenderPipeline</span><span class="p">(</span>
<span class="w">    </span><span class="n">device</span>:<span class="w"> </span><span class="nc">native</span>::<span class="n">WGPUDevice</span><span class="p">,</span>
<span class="w">    </span><span class="n">descriptor</span>:<span class="w"> </span><span class="nb">Option</span><span class="o">&lt;&amp;</span><span class="n">native</span>::<span class="n">WGPURenderPipelineDescriptor</span><span class="o">&gt;</span><span class="p">,</span>
<span class="p">)</span><span class="w"> </span>-&gt;<span class="w"> </span><span class="nc">native</span>::<span class="n">WGPURenderPipeline</span><span class="w"> </span><span class="p">{</span>
<span class="w">    </span><span class="kd">let</span><span class="w"> </span><span class="p">(</span><span class="n">device</span><span class="p">,</span><span class="w"> </span><span class="n">context</span><span class="p">)</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">device</span><span class="p">.</span><span class="n">unwrap_handle</span><span class="p">();</span>
<span class="w">    </span><span class="kd">let</span><span class="w"> </span><span class="n">descriptor</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">descriptor</span><span class="p">.</span><span class="n">expect</span><span class="p">(</span><span class="s">&quot;invalid</span><span class="w"> </span><span class="s">descriptor&quot;</span><span class="p">);</span>

<span class="w">    </span><span class="kd">let</span><span class="w"> </span><span class="n">foo_config</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">follow_chain</span><span class="o">!</span><span class="p">(</span>
<span class="w">        </span><span class="n">map_render_pipeline_descriptor</span><span class="p">(</span>
<span class="w">            </span><span class="n">descriptor</span><span class="p">,</span>
<span class="w">            </span><span class="n">WGPUFooSType_FooRenderPipelineDescriptor</span><span class="w"> </span><span class="o">=&gt;</span><span class="w"> </span><span class="n">native</span>::<span class="n">WGPUFooRenderPipelineDescriptor</span><span class="p">)</span>
<span class="w">    </span><span class="p">);</span>

<span class="w">    </span><span class="c1">//</span><span class="w"> </span><span class="c1">[...]</span>

<span class="w">    </span><span class="kd">let</span><span class="w"> </span><span class="n">desc</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">wgc</span>::<span class="n">pipeline</span>::<span class="n">RenderPipelineDescriptor</span><span class="w"> </span><span class="p">{</span>
<span class="w">        </span><span class="c1">//</span><span class="w"> </span><span class="c1">[...]</span>
<span class="w">        </span><span class="n">foo</span>:<span class="w"> </span><span class="nc">foo_config</span><span class="p">,</span>
<span class="w">    </span><span class="p">};</span>
<span class="p">}</span>
</pre></div>
</div>
<p>This calls a <code class="docutils literal notranslate"><span class="pre">map_render_pipeline_descriptor</span></code> that we create in <code class="docutils literal notranslate"><span class="pre">conv.rs</span></code>:</p>
<div class="highlight-rust notranslate"><div class="highlight"><pre><span></span><span class="k">pub</span><span class="w"> </span><span class="k">unsafe</span><span class="w"> </span><span class="k">fn</span><span class="w"> </span><span class="nf">map_render_pipeline_descriptor</span><span class="o">&lt;&#39;</span><span class="na">a</span><span class="o">&gt;</span><span class="p">(</span>
<span class="w">    </span><span class="n">_</span>:<span class="w"> </span><span class="kp">&amp;</span><span class="nc">native</span>::<span class="n">WGPURenderPipelineDescriptor</span><span class="p">,</span>
<span class="w">    </span><span class="n">foo</span>:<span class="w"> </span><span class="nb">Option</span><span class="o">&lt;&amp;</span><span class="n">native</span>::<span class="n">WGPUFooRenderPipelineDescriptor</span><span class="o">&gt;</span><span class="p">,</span>
<span class="p">)</span><span class="w"> </span>-&gt;<span class="w"> </span><span class="nb">Option</span><span class="o">&lt;</span><span class="kt">u32</span><span class="o">&gt;</span><span class="w"> </span><span class="p">{</span>
<span class="w">    </span><span class="n">foo</span><span class="p">.</span><span class="n">map</span><span class="p">(</span><span class="o">|</span><span class="n">x</span><span class="o">|</span><span class="w"> </span><span class="n">x</span><span class="p">.</span><span class="n">foo</span><span class="p">)</span>
<span class="p">}</span>
</pre></div>
</div>
<div class="admonition note">
<p class="admonition-title">Note</p>
<p>In this case, the whole <code class="docutils literal notranslate"><span class="pre">let</span> <span class="pre">desc</span> <span class="pre">=</span> <span class="pre">...</span></code> part could also be moved inside of <code class="docutils literal notranslate"><span class="pre">map_render_pipeline_descriptor</span></code>.</p>
</div>
</section>
<section id="extending-backends">
<h3>Extending backends<a class="headerlink" href="custom-extensions.html#extending-backends" title="Permalink to this heading">#</a></h3>
<div class="admonition warning">
<p class="admonition-title">Warning</p>
<p>TODO: I still need to learn better how the code is organized.</p>
</div>
<p>The file <code class="docutils literal notranslate"><span class="pre">wgpu/wgpu-hal/src/lib.rs</span></code> defines the interface that each backend must implement. Backends are the subdirectories of <code class="docutils literal notranslate"><span class="pre">wgpu/wgpu-hal/src</span></code> as well as the <code class="docutils literal notranslate"><span class="pre">empty.rs</span></code> file that defines a default behavior that does nothing.</p>
<p>We implement backends one by one, maybe only for the ones that interest us in practice. We must thus make sure that the <code class="docutils literal notranslate"><span class="pre">Foo</span></code> feature is advertised by the adapter only for the backend that we implemented.</p>
<div class="highlight-C++ notranslate"><div class="highlight"><pre><span></span><span class="n">TODO</span>
</pre></div>
</div>
</section>
</section>
<section id="with-dawn">
<h2>With Dawn<a class="headerlink" href="custom-extensions.html#with-dawn" title="Permalink to this heading">#</a></h2>
<p>TODO</p>
</section>
</section>

        </article>
      </div>
      <footer>
        
        <div class="related-pages">
          <a class="next-page" href="references.html">
              <div class="page-info">
                <div class="context">
                  <span>Next</span>
                </div>
                <div class="title">References (🚧WIP)</div>
              </div>
              <svg class="furo-related-icon"><use href="#svg-arrow-right"></use></svg>
            </a>
          <a class="prev-page" href="memory-model.html">
              <svg class="furo-related-icon"><use href="#svg-arrow-right"></use></svg>
              <div class="page-info">
                <div class="context">
                  <span>Previous</span>
                </div>
                
                <div class="title">Memory Model (🛑TODO)</div>
                
              </div>
            </a>
        </div>
        <div class="bottom-of-page">
          <div class="left-details">
            <div class="copyright">
                Copyright &#169; 2022-2023, Élie Michel and contributors
            </div>
            Made with <a href="https://www.sphinx-doc.org/">Sphinx</a> and <a class="muted-link" href="https://pradyunsg.me">@pradyunsg</a>'s
            
            <a href="https://github.com/pradyunsg/furo">Furo</a>
            
          </div>
          <div class="right-details">
            <div class="icons">
              <a class="muted-link " href="https://github.com/eliemichel/LearnWebGPU" aria-label="GitHub">
                <svg stroke="currentColor" fill="currentColor" stroke-width="0" viewBox="0 0 16 16">
                    <path fill-rule="evenodd" d="M8 0C3.58 0 0 3.58 0 8c0 3.54 2.29 6.53 5.47 7.59.4.07.55-.17.55-.38 0-.19-.01-.82-.01-1.49-2.01.37-2.53-.49-2.69-.94-.09-.23-.48-.94-.82-1.13-.28-.15-.68-.52-.01-.53.63-.01 1.08.58 1.23.82.72 1.21 1.87.87 2.33.66.07-.52.28-.87.51-1.07-1.78-.2-3.64-.89-3.64-3.95 0-.87.31-1.59.82-2.15-.08-.2-.36-1.02.08-2.12 0 0 .67-.21 2.2.82.64-.18 1.32-.27 2-.27.68 0 1.36.09 2 .27 1.53-1.04 2.2-.82 2.2-.82.44 1.1.16 1.92.08 2.12.51.56.82 1.27.82 2.15 0 3.07-1.87 3.75-3.65 3.95.29.25.54.73.54 1.48 0 1.07-.01 1.93-.01 2.2 0 .21.15.46.55.38A8.013 8.013 0 0 0 16 8c0-4.42-3.58-8-8-8z"></path>
                </svg>
            </a>
              
            </div>
          </div>
        </div>
        
      </footer>
    </div>
    <aside class="toc-drawer">
      <div class="toc-sticky toc-scroll">
	<div class="toc-title-container">
		<span class="toc-title">
			On this page
		</span>
	</div>
	<div class="toc-tree-container">
		<div class="toc-tree">
			<ul>
<li><a class="reference internal" href="custom-extensions.html#">Custom Extensions (🚧WIP)</a><ul>
<li><a class="reference internal" href="custom-extensions.html#the-extension-mechanism">The extension mechanism</a><ul>
<li><a class="reference internal" href="custom-extensions.html#descriptor-extensions">Descriptor extensions</a><ul>
<li><a class="reference internal" href="custom-extensions.html#structure-type">Structure type</a></li>
<li><a class="reference internal" href="custom-extensions.html#structure-fields">Structure fields</a></li>
</ul>
</li>
<li><a class="reference internal" href="custom-extensions.html#adapter-features">Adapter features</a></li>
</ul>
</li>
<li><a class="reference internal" href="custom-extensions.html#with-wgpu-native">With <code class="docutils literal notranslate"><span class="pre">wgpu-native</span></code></a><ul>
<li><a class="reference internal" href="custom-extensions.html#building-wgpu-native">Building <code class="docutils literal notranslate"><span class="pre">wgpu-native</span></code></a></li>
<li><a class="reference internal" href="custom-extensions.html#building-wgpu">Building <code class="docutils literal notranslate"><span class="pre">wgpu</span></code></a></li>
<li><a class="reference internal" href="custom-extensions.html#extending-types">Extending types</a></li>
<li><a class="reference internal" href="custom-extensions.html#extending-core">Extending core</a></li>
<li><a class="reference internal" href="custom-extensions.html#extending-backends">Extending backends</a></li>
</ul>
</li>
<li><a class="reference internal" href="custom-extensions.html#with-dawn">With Dawn</a></li>
</ul>
</li>
</ul>

		</div>
	</div>
	
</div>
    </aside>
  </div>
</div><script data-url_root="../" id="documentation_options" src="../_static/documentation_options.js"></script>
    <script src="../_static/jquery.js"></script>
    <script src="../_static/underscore.js"></script>
    <script src="../_static/_sphinx_javascript_frameworks_compat.js"></script>
    <script src="../_static/doctools.js"></script>
    <script src="../_static/sphinx_highlight.js"></script>
    <script src="../_static/scripts/furo.js"></script>
    <script src="../_static/clipboard.min.js"></script>
    <script src="../_static/copybutton.js"></script>
    <script src="../_static/tabs.js"></script>
    <script src="../_static/sphinx_literate.js"></script>
    </body>
</html>