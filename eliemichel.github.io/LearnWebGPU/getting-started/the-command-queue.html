<!doctype html>
<html class="no-js" lang="en">
  <head><meta charset="utf-8"/>
    <meta name="viewport" content="width=device-width,initial-scale=1"/>
    <meta name="color-scheme" content="light dark"><meta name="generator" content="Docutils 0.19: https://docutils.sourceforge.io/" />
<meta property="og:title" content="The Command Queue" />
<meta property="og:type" content="website" />
<meta property="og:url" content="https://eliemichel.github.io/getting-started/the-command-queue.html" />
<meta property="og:site_name" content="Learn WebGPU for C++" />
<meta property="og:description" content="Resulting code: step017 We are getting close, but we will still not display anything on our window. We learn in this chapter a key concept of WebGPU (and of most modern graphics APIs as well): the ..." />
<meta property="og:image" content="https://eliemichel.github.io/images/webgpu-responsive.svg" />
<meta property="og:image:alt" content="Learn WebGPU for C++" />
<meta name="description" content="Resulting code: step017 We are getting close, but we will still not display anything on our window. We learn in this chapter a key concept of WebGPU (and of most modern graphics APIs as well): the ..." />
    <link rel="icon" type="image/svg+xml" href="../_static/favicon/favicon.svg">
    <link rel="icon" sizes="16x16" href="../_static/favicon/favicon-16x16.png" type="image/png">
    <link rel="icon" sizes="32x32" href="../_static/favicon/favicon-32x32.png" type="image/png">
    <link rel="apple-touch-icon" sizes="180x180" href="https://eliemichel.github.io/LearnWebGPU/_static/favicon/apple-touch-icon-180x180.png" type="image/png"><link rel="index" title="Index" href="../genindex.html" /><link rel="search" title="Search" href="../search.html" /><link rel="next" title="First Color" href="first-color.html" /><link rel="prev" title="The Device" href="the-device.html" />

    <!-- Generated with Sphinx 5.3.0 and Furo 2023.03.27 -->
        <title>The Command Queue - Learn WebGPU for C++ documentation</title>
      <link rel="stylesheet" type="text/css" href="../_static/pygments.css" />
    <link rel="stylesheet" type="text/css" href="../_static/styles/furo.css?digest=fad236701ea90a88636c2a8c73b44ae642ed2a53" />
    <link rel="stylesheet" type="text/css" href="../_static/copybutton.css" />
    <link rel="stylesheet" type="text/css" href="../_static/tabs.css" />
    <link rel="stylesheet" type="text/css" href="../_static/styles/furo-extensions.css?digest=30d1aed668e5c3a91c3e3bf6a60b675221979f0e" />
    <link rel="stylesheet" type="text/css" href="../_static/extra.css" />
    <link rel="stylesheet" type="text/css" href="../_static/sphinx_literate.css" />
    
    


<style>
  body {
    --color-code-background: #eeffcc;
  --color-code-foreground: black;
  --color-brand-primary: #ac2800;
  --color-brand-content: #007cac;
  
  }
  @media not print {
    body[data-theme="dark"] {
      --color-code-background: #272822;
  --color-code-foreground: #f8f8f2;
  --color-brand-primary: #ce5733;
  --color-brand-content: #38a6b9;
  
    }
    @media (prefers-color-scheme: dark) {
      body:not([data-theme="light"]) {
        --color-code-background: #272822;
  --color-code-foreground: #f8f8f2;
  --color-brand-primary: #ce5733;
  --color-brand-content: #38a6b9;
  
      }
    }
  }
</style></head>
  <body>
    
    <script>
      document.body.dataset.theme = localStorage.getItem("theme") || "auto";
    </script>
    

<svg xmlns="http://www.w3.org/2000/svg" style="display: none;">
  <symbol id="svg-toc" viewBox="0 0 24 24">
    <title>Contents</title>
    <svg stroke="currentColor" fill="currentColor" stroke-width="0" viewBox="0 0 1024 1024">
      <path d="M408 442h480c4.4 0 8-3.6 8-8v-56c0-4.4-3.6-8-8-8H408c-4.4 0-8 3.6-8 8v56c0 4.4 3.6 8 8 8zm-8 204c0 4.4 3.6 8 8 8h480c4.4 0 8-3.6 8-8v-56c0-4.4-3.6-8-8-8H408c-4.4 0-8 3.6-8 8v56zm504-486H120c-4.4 0-8 3.6-8 8v56c0 4.4 3.6 8 8 8h784c4.4 0 8-3.6 8-8v-56c0-4.4-3.6-8-8-8zm0 632H120c-4.4 0-8 3.6-8 8v56c0 4.4 3.6 8 8 8h784c4.4 0 8-3.6 8-8v-56c0-4.4-3.6-8-8-8zM115.4 518.9L271.7 642c5.8 4.6 14.4.5 14.4-6.9V388.9c0-7.4-8.5-11.5-14.4-6.9L115.4 505.1a8.74 8.74 0 0 0 0 13.8z"/>
    </svg>
  </symbol>
  <symbol id="svg-menu" viewBox="0 0 24 24">
    <title>Menu</title>
    <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24" fill="none" stroke="currentColor"
      stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="feather-menu">
      <line x1="3" y1="12" x2="21" y2="12"></line>
      <line x1="3" y1="6" x2="21" y2="6"></line>
      <line x1="3" y1="18" x2="21" y2="18"></line>
    </svg>
  </symbol>
  <symbol id="svg-arrow-right" viewBox="0 0 24 24">
    <title>Expand</title>
    <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24" fill="none" stroke="currentColor"
      stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="feather-chevron-right">
      <polyline points="9 18 15 12 9 6"></polyline>
    </svg>
  </symbol>
  <symbol id="svg-sun" viewBox="0 0 24 24">
    <title>Light mode</title>
    <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24" fill="none" stroke="currentColor"
      stroke-width="1.5" stroke-linecap="round" stroke-linejoin="round" class="feather-sun">
      <circle cx="12" cy="12" r="5"></circle>
      <line x1="12" y1="1" x2="12" y2="3"></line>
      <line x1="12" y1="21" x2="12" y2="23"></line>
      <line x1="4.22" y1="4.22" x2="5.64" y2="5.64"></line>
      <line x1="18.36" y1="18.36" x2="19.78" y2="19.78"></line>
      <line x1="1" y1="12" x2="3" y2="12"></line>
      <line x1="21" y1="12" x2="23" y2="12"></line>
      <line x1="4.22" y1="19.78" x2="5.64" y2="18.36"></line>
      <line x1="18.36" y1="5.64" x2="19.78" y2="4.22"></line>
    </svg>
  </symbol>
  <symbol id="svg-moon" viewBox="0 0 24 24">
    <title>Dark mode</title>
    <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24" fill="none" stroke="currentColor"
      stroke-width="1.5" stroke-linecap="round" stroke-linejoin="round" class="icon-tabler-moon">
      <path stroke="none" d="M0 0h24v24H0z" fill="none" />
      <path d="M12 3c.132 0 .263 0 .393 0a7.5 7.5 0 0 0 7.92 12.446a9 9 0 1 1 -8.313 -12.454z" />
    </svg>
  </symbol>
  <symbol id="svg-sun-half" viewBox="0 0 24 24">
    <title>Auto light/dark mode</title>
    <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24" fill="none" stroke="currentColor"
      stroke-width="1.5" stroke-linecap="round" stroke-linejoin="round" class="icon-tabler-shadow">
      <path stroke="none" d="M0 0h24v24H0z" fill="none"/>
      <circle cx="12" cy="12" r="9" />
      <path d="M13 12h5" />
      <path d="M13 15h4" />
      <path d="M13 18h1" />
      <path d="M13 9h4" />
      <path d="M13 6h1" />
    </svg>
  </symbol>
</svg>

<input type="checkbox" class="sidebar-toggle" name="__navigation" id="__navigation">
<input type="checkbox" class="sidebar-toggle" name="__toc" id="__toc">
<label class="overlay sidebar-overlay" for="__navigation">
  <div class="visually-hidden">Hide navigation sidebar</div>
</label>
<label class="overlay toc-overlay" for="__toc">
  <div class="visually-hidden">Hide table of contents sidebar</div>
</label>

<div class="announcement">
  <aside class="announcement-content">
     <em>Important</em> This documentation is a work in progress! <a href="../appendices/feedback-needed.html">Feedback needed!</a> 
  </aside>
</div>

<div class="page">
  <header class="mobile-header">
    <div class="header-left">
      <label class="nav-overlay-icon" for="__navigation">
        <div class="visually-hidden">Toggle site navigation sidebar</div>
        <i class="icon"><svg><use href="#svg-menu"></use></svg></i>
      </label>
    </div>
    <div class="header-center">
      <a href="../index.html"><div class="brand">Learn WebGPU for C++  documentation</div></a>
    </div>
    <div class="header-right">
      <div class="theme-toggle-container theme-toggle-header">
        <button class="theme-toggle">
          <div class="visually-hidden">Toggle Light / Dark / Auto color theme</div>
          <svg class="theme-icon-when-auto"><use href="#svg-sun-half"></use></svg>
          <svg class="theme-icon-when-dark"><use href="#svg-moon"></use></svg>
          <svg class="theme-icon-when-light"><use href="#svg-sun"></use></svg>
        </button>
      </div>
      <label class="toc-overlay-icon toc-header-icon" for="__toc">
        <div class="visually-hidden">Toggle table of contents sidebar</div>
        <i class="icon"><svg><use href="#svg-toc"></use></svg></i>
      </label>
    </div>
  </header>
  <aside class="sidebar-drawer">
    <div class="sidebar-container">
      
      <div class="sidebar-sticky"><a class="sidebar-brand" href="../index.html">
  
  <div class="sidebar-logo-container">
    <img class="sidebar-logo only-light" src="../_static/webgpu-light.svg" alt="Light Logo"/>
    <img class="sidebar-logo only-dark" src="../_static/webgpu-dark.svg" alt="Dark Logo"/>
  </div>
  
  
</a><form class="sidebar-search-container" method="get" action="../search.html" role="search">
  <input class="sidebar-search" placeholder="Search" name="q" aria-label="Search">
  <input type="hidden" name="check_keywords" value="yes">
  <input type="hidden" name="area" value="default">
</form>
<div id="searchbox"></div><div class="sidebar-scroll"><div class="sidebar-tree">
  <ul class="current">
<li class="toctree-l1"><a class="reference internal" href="../introduction.html">Introduction</a></li>
<li class="toctree-l1 current has-children"><a class="reference internal" href="index.html">Getting Started</a><input checked="" class="toctree-checkbox" id="toctree-checkbox-1" name="toctree-checkbox-1" role="switch" type="checkbox"/><label for="toctree-checkbox-1"><div class="visually-hidden">Toggle child pages in navigation</div><i class="icon"><svg><use href="#svg-arrow-right"></use></svg></i></label><ul class="current">
<li class="toctree-l2"><a class="reference internal" href="project-setup.html">Project setup</a></li>
<li class="toctree-l2"><a class="reference internal" href="opening-a-window.html">Opening a window</a></li>
<li class="toctree-l2"><a class="reference internal" href="hello-webgpu.html">Hello WebGPU</a></li>
<li class="toctree-l2"><a class="reference internal" href="the-adapter.html">The Adapter</a></li>
<li class="toctree-l2"><a class="reference internal" href="the-device.html">The Device</a></li>
<li class="toctree-l2 current current-page"><a class="current reference internal" href="the-command-queue.html#">The Command Queue</a></li>
<li class="toctree-l2"><a class="reference internal" href="first-color.html">First Color</a></li>
<li class="toctree-l2"><a class="reference internal" href="cpp-idioms.html">C++ wrapper</a></li>
</ul>
</li>
<li class="toctree-l1 has-children"><a class="reference internal" href="../basic-3d-rendering/index.html">Basic 3D Rendering</a><input class="toctree-checkbox" id="toctree-checkbox-2" name="toctree-checkbox-2" role="switch" type="checkbox"/><label for="toctree-checkbox-2"><div class="visually-hidden">Toggle child pages in navigation</div><i class="icon"><svg><use href="#svg-arrow-right"></use></svg></i></label><ul>
<li class="toctree-l2"><a class="reference internal" href="../basic-3d-rendering/hello-triangle.html">Hello Triangle</a></li>
<li class="toctree-l2 has-children"><a class="reference internal" href="../basic-3d-rendering/input-geometry/index.html">Input Geometry</a><input class="toctree-checkbox" id="toctree-checkbox-3" name="toctree-checkbox-3" role="switch" type="checkbox"/><label for="toctree-checkbox-3"><div class="visually-hidden">Toggle child pages in navigation</div><i class="icon"><svg><use href="#svg-arrow-right"></use></svg></i></label><ul>
<li class="toctree-l3"><a class="reference internal" href="../basic-3d-rendering/input-geometry/playing-with-buffers.html">Playing with buffers</a></li>
<li class="toctree-l3"><a class="reference internal" href="../basic-3d-rendering/input-geometry/a-first-vertex-attribute.html">A first Vertex Attribute</a></li>
<li class="toctree-l3"><a class="reference internal" href="../basic-3d-rendering/input-geometry/multiple-attributes.html">Multiple Attributes</a></li>
<li class="toctree-l3"><a class="reference internal" href="../basic-3d-rendering/input-geometry/index-buffer.html">Index Buffer</a></li>
<li class="toctree-l3"><a class="reference internal" href="../basic-3d-rendering/input-geometry/loading-from-file.html">Loading from file</a></li>
</ul>
</li>
<li class="toctree-l2 has-children"><a class="reference internal" href="../basic-3d-rendering/shader-uniforms/index.html">Shader Uniforms</a><input class="toctree-checkbox" id="toctree-checkbox-4" name="toctree-checkbox-4" role="switch" type="checkbox"/><label for="toctree-checkbox-4"><div class="visually-hidden">Toggle child pages in navigation</div><i class="icon"><svg><use href="#svg-arrow-right"></use></svg></i></label><ul>
<li class="toctree-l3"><a class="reference internal" href="../basic-3d-rendering/shader-uniforms/a-first-uniform.html">A first uniform</a></li>
<li class="toctree-l3"><a class="reference internal" href="../basic-3d-rendering/shader-uniforms/multiple-uniforms.html">More uniforms</a></li>
<li class="toctree-l3"><a class="reference internal" href="../basic-3d-rendering/shader-uniforms/dynamic-uniforms.html">Dynamic uniforms</a></li>
</ul>
</li>
<li class="toctree-l2 has-children"><a class="reference internal" href="../basic-3d-rendering/3d-meshes/index.html">3D Meshes</a><input class="toctree-checkbox" id="toctree-checkbox-5" name="toctree-checkbox-5" role="switch" type="checkbox"/><label for="toctree-checkbox-5"><div class="visually-hidden">Toggle child pages in navigation</div><i class="icon"><svg><use href="#svg-arrow-right"></use></svg></i></label><ul>
<li class="toctree-l3"><a class="reference internal" href="../basic-3d-rendering/3d-meshes/a-simple-example.html">A simple example</a></li>
<li class="toctree-l3"><a class="reference internal" href="../basic-3d-rendering/3d-meshes/depth-buffer.html">Depth buffer</a></li>
<li class="toctree-l3"><a class="reference internal" href="../basic-3d-rendering/3d-meshes/transformation-matrices.html">Transformation matrices</a></li>
<li class="toctree-l3"><a class="reference internal" href="../basic-3d-rendering/3d-meshes/projection-matrices.html">Projection matrices</a></li>
<li class="toctree-l3"><a class="reference internal" href="../basic-3d-rendering/3d-meshes/basic-shading.html">Basic shading</a></li>
<li class="toctree-l3"><a class="reference internal" href="../basic-3d-rendering/3d-meshes/loading-from-file.html">Loading from file</a></li>
</ul>
</li>
<li class="toctree-l2 has-children"><a class="reference internal" href="../basic-3d-rendering/texturing/index.html">Texturing</a><input class="toctree-checkbox" id="toctree-checkbox-6" name="toctree-checkbox-6" role="switch" type="checkbox"/><label for="toctree-checkbox-6"><div class="visually-hidden">Toggle child pages in navigation</div><i class="icon"><svg><use href="#svg-arrow-right"></use></svg></i></label><ul>
<li class="toctree-l3"><a class="reference internal" href="../basic-3d-rendering/texturing/a-first-texture.html">A first texture</a></li>
<li class="toctree-l3"><a class="reference internal" href="../basic-3d-rendering/texturing/texture-mapping.html">Texture mapping</a></li>
<li class="toctree-l3"><a class="reference internal" href="../basic-3d-rendering/texturing/sampler.html">Sampler</a></li>
<li class="toctree-l3"><a class="reference internal" href="../basic-3d-rendering/texturing/loading-from-file.html">Loading from file</a></li>
</ul>
</li>
<li class="toctree-l2 has-children"><a class="reference internal" href="../basic-3d-rendering/some-interaction/index.html">Some interaction</a><input class="toctree-checkbox" id="toctree-checkbox-7" name="toctree-checkbox-7" role="switch" type="checkbox"/><label for="toctree-checkbox-7"><div class="visually-hidden">Toggle child pages in navigation</div><i class="icon"><svg><use href="#svg-arrow-right"></use></svg></i></label><ul>
<li class="toctree-l3"><a class="reference internal" href="../basic-3d-rendering/some-interaction/refactoring.html">Refactoring</a></li>
<li class="toctree-l3"><a class="reference internal" href="../basic-3d-rendering/some-interaction/resizing-window.html">Resizing the window</a></li>
<li class="toctree-l3"><a class="reference internal" href="../basic-3d-rendering/some-interaction/camera-control.html">Camera control</a></li>
<li class="toctree-l3"><a class="reference internal" href="../basic-3d-rendering/some-interaction/simple-gui.html">Simple GUI</a></li>
</ul>
</li>
<li class="toctree-l2 has-children"><a class="reference internal" href="../basic-3d-rendering/lighting-and-material/index.html">Lighting and Material</a><input class="toctree-checkbox" id="toctree-checkbox-8" name="toctree-checkbox-8" role="switch" type="checkbox"/><label for="toctree-checkbox-8"><div class="visually-hidden">Toggle child pages in navigation</div><i class="icon"><svg><use href="#svg-arrow-right"></use></svg></i></label><ul>
<li class="toctree-l3"><a class="reference internal" href="../basic-3d-rendering/lighting-and-material/recap.html">Recap</a></li>
<li class="toctree-l3"><a class="reference internal" href="../basic-3d-rendering/lighting-and-material/specular.html">Specularity</a></li>
<li class="toctree-l3"><a class="reference internal" href="../basic-3d-rendering/lighting-and-material/normal-mapping.html">Normal mapping (🚧WIP)</a></li>
<li class="toctree-l3"><a class="reference internal" href="../basic-3d-rendering/lighting-and-material/ibl.html">Image-Based Lighting (🚧WIP)</a></li>
<li class="toctree-l3"><a class="reference internal" href="../basic-3d-rendering/lighting-and-material/cubemap.html">Cube Maps (🚧WIP)</a></li>
<li class="toctree-l3"><a class="reference internal" href="../basic-3d-rendering/lighting-and-material/pbr.html">Physically-Based Materials (🚧WIP)</a></li>
</ul>
</li>
</ul>
</li>
<li class="toctree-l1 has-children"><a class="reference internal" href="../basic-compute/index.html">Basic Compute</a><input class="toctree-checkbox" id="toctree-checkbox-9" name="toctree-checkbox-9" role="switch" type="checkbox"/><label for="toctree-checkbox-9"><div class="visually-hidden">Toggle child pages in navigation</div><i class="icon"><svg><use href="#svg-arrow-right"></use></svg></i></label><ul>
<li class="toctree-l2"><a class="reference internal" href="../basic-compute/compute-pipeline.html">Compute Pipeline</a></li>
<li class="toctree-l2 has-children"><a class="reference internal" href="../basic-compute/image-processing/index.html">Image Processing</a><input class="toctree-checkbox" id="toctree-checkbox-10" name="toctree-checkbox-10" role="switch" type="checkbox"/><label for="toctree-checkbox-10"><div class="visually-hidden">Toggle child pages in navigation</div><i class="icon"><svg><use href="#svg-arrow-right"></use></svg></i></label><ul>
<li class="toctree-l3"><a class="reference internal" href="../basic-compute/image-processing/mipmap-generation.html">Mipmap Generation</a></li>
<li class="toctree-l3"><a class="reference internal" href="../basic-compute/image-processing/convolution-filters.html">Convolution Filters</a></li>
<li class="toctree-l3"><a class="reference internal" href="../basic-compute/image-processing/cubemap-conversion.html">Cubemap Conversion (🚧WIP)</a></li>
<li class="toctree-l3"><a class="reference internal" href="../basic-compute/image-processing/cubemap-prefiltering.html">Cubemap Prefiltering (🚧WIP)</a></li>
</ul>
</li>
<li class="toctree-l2 has-children"><a class="reference internal" href="../basic-compute/procedural-geometry/index.html">Procedural Geometry</a><input class="toctree-checkbox" id="toctree-checkbox-11" name="toctree-checkbox-11" role="switch" type="checkbox"/><label for="toctree-checkbox-11"><div class="visually-hidden">Toggle child pages in navigation</div><i class="icon"><svg><use href="#svg-arrow-right"></use></svg></i></label><ul>
<li class="toctree-l3"><a class="reference internal" href="../basic-compute/procedural-geometry/deformation.html">Deformation (🚧WIP)</a></li>
</ul>
</li>
<li class="toctree-l2"><a class="reference internal" href="../basic-compute/neural-networks.html">Neural Networks (🛑TODO)</a></li>
</ul>
</li>
<li class="toctree-l1 has-children"><a class="reference internal" href="../advanced-techniques/index.html">Advanced Techniques</a><input class="toctree-checkbox" id="toctree-checkbox-12" name="toctree-checkbox-12" role="switch" type="checkbox"/><label for="toctree-checkbox-12"><div class="visually-hidden">Toggle child pages in navigation</div><i class="icon"><svg><use href="#svg-arrow-right"></use></svg></i></label><ul>
<li class="toctree-l2"><a class="reference internal" href="../advanced-techniques/raii.html">RAII</a></li>
<li class="toctree-l2"><a class="reference internal" href="../advanced-techniques/hdr-textures.html">High Dynamic Range Textures (🚧WIP)</a></li>
<li class="toctree-l2"><a class="reference internal" href="../advanced-techniques/deferred-shading.html">Deferred Shading (🛑TODO)</a></li>
<li class="toctree-l2"><a class="reference internal" href="../advanced-techniques/benchmarking.html">Benchmarking (🛑TODO)</a></li>
<li class="toctree-l2"><a class="reference internal" href="../advanced-techniques/render-bundles.html">Render Bundles (🛑TODO)</a></li>
<li class="toctree-l2"><a class="reference internal" href="../advanced-techniques/multi-sampling.html">Multi-Sampling (🛑TODO)</a></li>
<li class="toctree-l2"><a class="reference internal" href="../advanced-techniques/scene-tree.html">Scene tree (🛑TODO)</a></li>
<li class="toctree-l2"><a class="reference internal" href="../advanced-techniques/screen-capture.html">Screen capture (🚧WIP)</a></li>
<li class="toctree-l2"><a class="reference internal" href="../advanced-techniques/shadow-maps.html">Shadow maps (🛑TODO)</a></li>
<li class="toctree-l2"><a class="reference internal" href="../advanced-techniques/tesselation.html">Tesselation (🛑TODO)</a></li>
<li class="toctree-l2"><a class="reference internal" href="../advanced-techniques/raytracing.html">Raytracing (🛑TODO)</a></li>
</ul>
</li>
<li class="toctree-l1 has-children"><a class="reference internal" href="../appendices/index.html">Appendices</a><input class="toctree-checkbox" id="toctree-checkbox-13" name="toctree-checkbox-13" role="switch" type="checkbox"/><label for="toctree-checkbox-13"><div class="visually-hidden">Toggle child pages in navigation</div><i class="icon"><svg><use href="#svg-arrow-right"></use></svg></i></label><ul>
<li class="toctree-l2"><a class="reference internal" href="../appendices/teaching-native-graphics-in-2023.html">Teaching native graphics in 2023</a></li>
<li class="toctree-l2"><a class="reference internal" href="../appendices/feedback-needed.html">Feedback needed</a></li>
<li class="toctree-l2"><a class="reference internal" href="../appendices/debugging.html">Debugging (🚧WIP)</a></li>
<li class="toctree-l2"><a class="reference internal" href="../appendices/building-for-the-web.html">Building for the Web (🚧WIP)</a></li>
<li class="toctree-l2"><a class="reference internal" href="../appendices/memory-model.html">Memory Model (🛑TODO)</a></li>
<li class="toctree-l2"><a class="reference internal" href="../appendices/custom-extensions.html">Custom Extensions (🚧WIP)</a></li>
<li class="toctree-l2"><a class="reference internal" href="../appendices/references.html">References (🚧WIP)</a></li>
<li class="toctree-l2"><a class="reference internal" href="../appendices/tmp.html">Temporary page</a></li>
</ul>
</li>
</ul>

</div>
</div>

      </div>
      
    </div>
  </aside>
  <div class="main">
    <div class="content">
      <div class="article-container">
        <a href="the-command-queue.html#" class="back-to-top muted-link">
          <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24">
            <path d="M13 20h-2V8l-5.5 5.5-1.42-1.42L12 4.16l7.92 7.92-1.42 1.42L13 8v12z"></path>
          </svg>
          <span>Back to top</span>
        </a>
        <div class="content-icon-container">
          <div class="edit-this-page">
  <a class="muted-link" href="https://github.com/eliemichel/LearnWebGPU/edit/main/./getting-started/the-command-queue.md" title="Edit this page">
    <svg aria-hidden="true" viewBox="0 0 24 24" stroke-width="1.5" stroke="currentColor" fill="none" stroke-linecap="round" stroke-linejoin="round">
      <path stroke="none" d="M0 0h24v24H0z" fill="none"/>
      <path d="M4 20h4l10.5 -10.5a1.5 1.5 0 0 0 -4 -4l-10.5 10.5v4" />
      <line x1="13.5" y1="6.5" x2="17.5" y2="10.5" />
    </svg>
    <span class="visually-hidden">Edit this page</span>
  </a>
</div><div class="theme-toggle-container theme-toggle-content">
            <button class="theme-toggle">
              <div class="visually-hidden">Toggle Light / Dark / Auto color theme</div>
              <svg class="theme-icon-when-auto"><use href="#svg-sun-half"></use></svg>
              <svg class="theme-icon-when-dark"><use href="#svg-moon"></use></svg>
              <svg class="theme-icon-when-light"><use href="#svg-sun"></use></svg>
            </button>
          </div>
          <label class="toc-overlay-icon toc-content-icon" for="__toc">
            <div class="visually-hidden">Toggle table of contents sidebar</div>
            <i class="icon"><svg><use href="#svg-toc"></use></svg></i>
          </label>
        </div>
        <article role="main">
          <section class="tex2jax_ignore mathjax_ignore" id="the-command-queue">
<h1>The Command Queue<a class="headerlink" href="the-command-queue.html#the-command-queue" title="Permalink to this heading">#</a></h1>
<p><em>Resulting code:</em> <a class="reference external" href="https://github.com/eliemichel/LearnWebGPU-Code/tree/step017"><code class="docutils literal notranslate"><span class="pre">step017</span></code></a></p>
<p>We are getting close, but we will still not display anything on our window. We learn in this chapter a key concept of WebGPU (and of most modern graphics APIs as well): the <strong>command queue</strong>.</p>
<figure class="align-center" id="id1">
<img alt="../_images/command-queue.png" class="with-shadow" src="../_images/command-queue.png" />
<figcaption>
<p><span class="caption-text">The CPU instructs the GPU what to do by sending commands through a command queue.</span><a class="headerlink" href="the-command-queue.html#id1" title="Permalink to this image">#</a></p>
</figcaption>
</figure>
<section id="different-timelines">
<h2>Different timelines<a class="headerlink" href="the-command-queue.html#different-timelines" title="Permalink to this heading">#</a></h2>
<p>One thing important to keep in mind when doing graphics programming: we have <strong>two processors running simultaneously</strong>. One of them is the CPU, also known as <em>host</em>, and the other one is the GPU, or <em>device</em>. There are two rules:</p>
<ol class="arabic simple">
<li><p><strong>The code we write runs on the CPU</strong>, and some of it triggers operations on the GPU. The only exception are <em>shaders</em>, which actually run on GPU.</p></li>
<li><p>Processors are “<strong>far away</strong>”, meaning that communicating between them takes time.</p></li>
</ol>
<p>They are not too far, but for high performance applications like real time graphics, this matters. In advanced pipelines, rendering a frame may involve thousands or tens of thousands of commands running on the GPU.</p>
<p>As a consequence, we cannot afford to send the commands one by one from the CPU and wait for a response after each one. Instead, commands meant to the GPU are batched and fired through a <strong>command queue</strong>. The GPU consumes this queue whenever it is ready, and this way processors minimize the time spend idling for their sibling to respond.</p>
<p>The CPU-side of your program, i.e., the C++ code that you write, lives in the <strong>Content timeline</strong>. The other side of the command queue is the <strong>Queue timeline</strong>, running on the GPU.</p>
<div class="admonition note">
<p class="admonition-title">Note</p>
<p>There is also a <strong>Device timeline</strong> defined in <a class="reference external" href="https://www.w3.org/TR/webgpu/#programming-model-timelines">WebGPU’s documentation</a>. It corresponds to the GPU operations for which our code actually waits for an immediate answer (called “synchronous” calls), but unlike the JavaScript API, it is roughly the same as the content timeline in our C++ case.</p>
</div>
</section>
<section id="queue-operations">
<h2>Queue operations<a class="headerlink" href="the-command-queue.html#queue-operations" title="Permalink to this heading">#</a></h2>
<p>Our WebGPU device has a single queue, which we can get with <code class="docutils literal notranslate"><span class="pre">wgpuDeviceGetQueue</span></code>.</p>
<div class="literal-block-wrapper lit-block-wrapper docutils container" id="lit-0">
<div class="highlight-C++ notranslate"><div class="highlight"><pre><span></span><span class="n">WGPUQueue</span><span class="w"> </span><span class="n">queue</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">wgpuDeviceGetQueue</span><span class="p">(</span><span class="n">device</span><span class="p">);</span>
</pre></div>
</div>
<lit-block-info data="{&quot;name&quot;: &quot;Get Queue&quot;, &quot;permalink&quot;: &quot;#lit-0&quot;, &quot;hidden&quot;: false, &quot;replaced by&quot;: [], &quot;completed in&quot;: [], &quot;prepended in&quot;: [], &quot;patched by&quot;: [], &quot;replacing&quot;: [], &quot;completing&quot;: [], &quot;prepending&quot;: [], &quot;inserted in&quot;: [], &quot;referenced in&quot;: [{&quot;name&quot;: &quot;Test command encoding&quot;, &quot;url&quot;: &quot;#lit-6&quot;, &quot;details&quot;: null}]}"></lit-block-info></div>
<div class="admonition note">
<p class="admonition-title">Note</p>
<p>Other graphics API allow one to build multiple queues per device, and future version of WebGPU might as well. But for now, one queue is already more than enough for us to play with!</p>
</div>
<p>Looking at <code class="docutils literal notranslate"><span class="pre">webgpu.h</span></code>, we find 3 different ways to submit work to this queue:</p>
<ul class="simple">
<li><p><code class="docutils literal notranslate"><span class="pre">wgpuQueueSubmit</span></code></p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">wgpuQueueWriteBuffer</span></code></p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">wgpuQueueWriteTexture</span></code></p></li>
</ul>
<p>The first one only sends commands (potentially complicated ones though), and the two other ones send memory from the CPU memory (RAM) to the GPU one (VRAM). This is where the delay of the communication might become particularly critical.</p>
<p>We also find a <code class="docutils literal notranslate"><span class="pre">wgpuQueueOnSubmittedWorkDone</span></code> procedure that we can use to set up a function to be called back once the work is done. Let us do it to make sure things happen as expected:</p>
<div class="literal-block-wrapper lit-block-wrapper docutils container" id="lit-1">
<div class="highlight-C++ notranslate"><div class="highlight"><pre><span></span><span class="k">auto</span><span class="w"> </span><span class="n">onQueueWorkDone</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="p">[](</span><span class="n">WGPUQueueWorkDoneStatus</span><span class="w"> </span><span class="n">status</span><span class="p">,</span><span class="w"> </span><span class="kt">void</span><span class="o">*</span><span class="w"> </span><span class="cm">/*</span><span class="w"> </span><span class="cm">pUserData</span><span class="w"> </span><span class="cm">*/</span><span class="p">)</span><span class="w"> </span><span class="p">{</span>
<span class="w">    </span><span class="n">std</span><span class="o">::</span><span class="n">cout</span><span class="w"> </span><span class="o">&lt;&lt;</span><span class="w"> </span><span class="s">&quot;Queued</span><span class="w"> </span><span class="s">work</span><span class="w"> </span><span class="s">finished</span><span class="w"> </span><span class="s">with</span><span class="w"> </span><span class="s">status:</span><span class="w"> </span><span class="s">&quot;</span><span class="w"> </span><span class="o">&lt;&lt;</span><span class="w"> </span><span class="n">status</span><span class="w"> </span><span class="o">&lt;&lt;</span><span class="w"> </span><span class="n">std</span><span class="o">::</span><span class="n">endl</span><span class="p">;</span>
<span class="p">};</span>
<span class="n">wgpuQueueOnSubmittedWorkDone</span><span class="p">(</span><span class="n">queue</span><span class="p">,</span><span class="w"> </span><span class="n">onQueueWorkDone</span><span class="p">,</span><span class="w"> </span><span class="k">nullptr</span><span class="w"> </span><span class="cm">/*</span><span class="w"> </span><span class="cm">pUserData</span><span class="w"> </span><span class="cm">*/</span><span class="p">);</span>
</pre></div>
</div>
<lit-block-info data="{&quot;name&quot;: &quot;Add queue callback&quot;, &quot;permalink&quot;: &quot;#lit-1&quot;, &quot;hidden&quot;: false, &quot;replaced by&quot;: [{&quot;name&quot;: &quot;Add queue callback&quot;, &quot;url&quot;: &quot;#lit-2&quot;, &quot;details&quot;: null}], &quot;completed in&quot;: [], &quot;prepended in&quot;: [], &quot;patched by&quot;: [], &quot;replacing&quot;: [], &quot;completing&quot;: [], &quot;prepending&quot;: [], &quot;inserted in&quot;: [], &quot;referenced in&quot;: [{&quot;name&quot;: &quot;Test command encoding&quot;, &quot;url&quot;: &quot;#lit-6&quot;, &quot;details&quot;: null}]}"></lit-block-info></div>
<div class="admonition error">
<p class="admonition-title">Error</p>
<p>As of now, the <code class="docutils literal notranslate"><span class="pre">wgpuQueueOnSubmittedWorkDone</span></code> is not implemented by our wgpu-native backend. Using it will result in a null pointer exception so do not copy the above code block.</p>
</div>
<div class="literal-block-wrapper lit-block-wrapper lit-block-hidden docutils container" id="lit-2">
<div class="highlight-C++ notranslate"><div class="highlight"><pre><span></span><span class="cp">#ifdef</span><span class="w"> </span><span class="cp">WEBGPU_BACKEND_DAWN</span>
<span class="c1">//</span><span class="w"> </span><span class="c1">Add</span><span class="w"> </span><span class="c1">a</span><span class="w"> </span><span class="c1">callback</span><span class="w"> </span><span class="c1">to</span><span class="w"> </span><span class="c1">monitor</span><span class="w"> </span><span class="c1">the</span><span class="w"> </span><span class="c1">moment</span><span class="w"> </span><span class="c1">queued</span><span class="w"> </span><span class="c1">work</span><span class="w"> </span><span class="c1">finished</span>
<span class="k">auto</span><span class="w"> </span><span class="n">onQueueWorkDone</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="p">[](</span><span class="n">WGPUQueueWorkDoneStatus</span><span class="w"> </span><span class="n">status</span><span class="p">,</span><span class="w"> </span><span class="kt">void</span><span class="o">*</span><span class="w"> </span><span class="cm">/*</span><span class="w"> </span><span class="cm">pUserData</span><span class="w"> </span><span class="cm">*/</span><span class="p">)</span><span class="w"> </span><span class="p">{</span>
<span class="w">    </span><span class="n">std</span><span class="o">::</span><span class="n">cout</span><span class="w"> </span><span class="o">&lt;&lt;</span><span class="w"> </span><span class="s">&quot;Queued</span><span class="w"> </span><span class="s">work</span><span class="w"> </span><span class="s">finished</span><span class="w"> </span><span class="s">with</span><span class="w"> </span><span class="s">status:</span><span class="w"> </span><span class="s">&quot;</span><span class="w"> </span><span class="o">&lt;&lt;</span><span class="w"> </span><span class="n">status</span><span class="w"> </span><span class="o">&lt;&lt;</span><span class="w"> </span><span class="n">std</span><span class="o">::</span><span class="n">endl</span><span class="p">;</span>
<span class="p">};</span>
<span class="n">wgpuQueueOnSubmittedWorkDone</span><span class="p">(</span><span class="n">queue</span><span class="p">,</span><span class="w"> </span><span class="mi">0</span><span class="w"> </span><span class="cm">/*</span><span class="w"> </span><span class="cm">non</span><span class="w"> </span><span class="cm">standard</span><span class="w"> </span><span class="cm">argument</span><span class="w"> </span><span class="cm">for</span><span class="w"> </span><span class="cm">Dawn</span><span class="w"> </span><span class="cm">*/</span><span class="p">,</span><span class="w"> </span><span class="n">onQueueWorkDone</span><span class="p">,</span><span class="w"> </span><span class="k">nullptr</span><span class="w"> </span><span class="cm">/*</span><span class="w"> </span><span class="cm">pUserData</span><span class="w"> </span><span class="cm">*/</span><span class="p">);</span>
<span class="cp">#endif</span><span class="w"> </span><span class="c1">//</span><span class="w"> </span><span class="c1">WEBGPU_BACKEND_DAWN</span>
</pre></div>
</div>
<lit-block-info data="{&quot;name&quot;: &quot;Add queue callback&quot;, &quot;permalink&quot;: &quot;#lit-2&quot;, &quot;hidden&quot;: true, &quot;replaced by&quot;: [], &quot;completed in&quot;: [], &quot;prepended in&quot;: [], &quot;patched by&quot;: [], &quot;replacing&quot;: [{&quot;name&quot;: &quot;Add queue callback&quot;, &quot;url&quot;: &quot;#lit-1&quot;, &quot;details&quot;: null}], &quot;completing&quot;: [], &quot;prepending&quot;: [], &quot;inserted in&quot;: [], &quot;referenced in&quot;: [{&quot;name&quot;: &quot;Test command encoding&quot;, &quot;url&quot;: &quot;#lit-6&quot;, &quot;details&quot;: null}]}"></lit-block-info></div>
</section>
<section id="submitting-commands">
<h2>Submitting commands<a class="headerlink" href="the-command-queue.html#submitting-commands" title="Permalink to this heading">#</a></h2>
<p>We submit commands using the following procedure:</p>
<div class="highlight-C++ notranslate"><div class="highlight"><pre><span></span><span class="n">wgpuQueueSubmit</span><span class="p">(</span><span class="n">queue</span><span class="p">,</span><span class="w"> </span><span class="cm">/*</span><span class="w"> </span><span class="cm">number</span><span class="w"> </span><span class="cm">of</span><span class="w"> </span><span class="cm">commands</span><span class="w"> </span><span class="cm">*/</span><span class="p">,</span><span class="w"> </span><span class="cm">/*</span><span class="w"> </span><span class="cm">pointer</span><span class="w"> </span><span class="cm">to</span><span class="w"> </span><span class="cm">the</span><span class="w"> </span><span class="cm">command</span><span class="w"> </span><span class="cm">array</span><span class="w"> </span><span class="cm">*/</span><span class="p">);</span>
</pre></div>
</div>
<p>We see <strong>a typical idiom</strong> here: WebGPU is a C API so whenever it needs to receive an array of things, we first provide the array size then a pointer to the first element.</p>
<p>If we have a single element, it is simply:</p>
<div class="highlight-C++ notranslate"><div class="highlight"><pre><span></span><span class="c1">//</span><span class="w"> </span><span class="c1">With</span><span class="w"> </span><span class="c1">a</span><span class="w"> </span><span class="c1">single</span><span class="w"> </span><span class="c1">command:</span>
<span class="n">WGPUCommandBuffer</span><span class="w"> </span><span class="n">command</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="cm">/*</span><span class="w"> </span><span class="cm">[...]</span><span class="w"> </span><span class="cm">*/</span><span class="p">;</span>
<span class="n">wgpuQueueSubmit</span><span class="p">(</span><span class="n">queue</span><span class="p">,</span><span class="w"> </span><span class="mi">1</span><span class="p">,</span><span class="w"> </span><span class="o">&amp;</span><span class="n">command</span><span class="p">);</span>
</pre></div>
</div>
<p>If we know at compile time (“statically”) the number of commands, we may use a C array (although a <code class="docutils literal notranslate"><span class="pre">std::array</span></code> is safer):</p>
<div class="highlight-C++ notranslate"><div class="highlight"><pre><span></span><span class="c1">//</span><span class="w"> </span><span class="c1">With</span><span class="w"> </span><span class="c1">a</span><span class="w"> </span><span class="c1">statically</span><span class="w"> </span><span class="c1">know</span><span class="w"> </span><span class="c1">number</span><span class="w"> </span><span class="c1">of</span><span class="w"> </span><span class="c1">commands:</span>
<span class="n">WGPUCommandBuffer</span><span class="w"> </span><span class="n">commands</span><span class="p">[</span><span class="mi">3</span><span class="p">];</span>
<span class="n">commands</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="cm">/*</span><span class="w"> </span><span class="cm">[...]</span><span class="w"> </span><span class="cm">*/</span><span class="p">;</span>
<span class="n">commands</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="cm">/*</span><span class="w"> </span><span class="cm">[...]</span><span class="w"> </span><span class="cm">*/</span><span class="p">;</span>
<span class="n">commands</span><span class="p">[</span><span class="mi">2</span><span class="p">]</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="cm">/*</span><span class="w"> </span><span class="cm">[...]</span><span class="w"> </span><span class="cm">*/</span><span class="p">;</span>
<span class="n">wgpuQueueSubmit</span><span class="p">(</span><span class="n">queue</span><span class="p">,</span><span class="w"> </span><span class="mi">3</span><span class="p">,</span><span class="w"> </span><span class="n">commands</span><span class="p">);</span>

<span class="c1">//</span><span class="w"> </span><span class="c1">or,</span><span class="w"> </span><span class="c1">safer</span><span class="w"> </span><span class="c1">and</span><span class="w"> </span><span class="c1">avoid</span><span class="w"> </span><span class="c1">repeating</span><span class="w"> </span><span class="c1">the</span><span class="w"> </span><span class="c1">array</span><span class="w"> </span><span class="c1">size:</span>
<span class="n">std</span><span class="o">::</span><span class="n">array</span><span class="o">&lt;</span><span class="n">WGPUCommandBuffer</span><span class="p">,</span><span class="w"> </span><span class="mi">3</span><span class="o">&gt;</span><span class="w"> </span><span class="n">commands</span><span class="p">;</span>
<span class="n">commands</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="cm">/*</span><span class="w"> </span><span class="cm">[...]</span><span class="w"> </span><span class="cm">*/</span><span class="p">;</span>
<span class="n">commands</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="cm">/*</span><span class="w"> </span><span class="cm">[...]</span><span class="w"> </span><span class="cm">*/</span><span class="p">;</span>
<span class="n">commands</span><span class="p">[</span><span class="mi">2</span><span class="p">]</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="cm">/*</span><span class="w"> </span><span class="cm">[...]</span><span class="w"> </span><span class="cm">*/</span><span class="p">;</span>
<span class="n">wgpuQueueSubmit</span><span class="p">(</span><span class="n">queue</span><span class="p">,</span><span class="w"> </span><span class="n">commands</span><span class="p">.</span><span class="n">size</span><span class="p">(),</span><span class="w"> </span><span class="n">commands</span><span class="p">.</span><span class="n">data</span><span class="p">());</span>
</pre></div>
</div>
<p>And if we need to dynamically change the size, we use a <code class="docutils literal notranslate"><span class="pre">std::vector</span></code>:</p>
<div class="highlight-C++ notranslate"><div class="highlight"><pre><span></span><span class="n">std</span><span class="o">::</span><span class="n">vector</span><span class="o">&lt;</span><span class="n">WGPUCommandBuffer</span><span class="o">&gt;</span><span class="w"> </span><span class="n">commands</span><span class="p">;</span>
<span class="c1">//</span><span class="w"> </span><span class="c1">[...]</span><span class="w"> </span><span class="c1">(Allocate</span><span class="w"> </span><span class="c1">and</span><span class="w"> </span><span class="c1">fill</span><span class="w"> </span><span class="c1">in</span><span class="w"> </span><span class="c1">command</span><span class="w"> </span><span class="c1">buffers)</span>
<span class="n">wgpuQueueSubmit</span><span class="p">(</span><span class="n">queue</span><span class="p">,</span><span class="w"> </span><span class="n">commands</span><span class="p">.</span><span class="n">size</span><span class="p">(),</span><span class="w"> </span><span class="n">commands</span><span class="p">.</span><span class="n">data</span><span class="p">());</span>
</pre></div>
</div>
<p>However, we <strong>cannot manually create</strong> a <code class="docutils literal notranslate"><span class="pre">WGPUCommandBuffer</span></code> object. This buffer uses a special format that is left to the discretion of your driver/hardware. To build this buffer, we use a <strong>command encoder</strong>.</p>
</section>
<section id="command-encoder">
<h2>Command encoder<a class="headerlink" href="the-command-queue.html#command-encoder" title="Permalink to this heading">#</a></h2>
<p>A command encoder is created following the usual object creation idiom of WebGPU:</p>
<div class="literal-block-wrapper lit-block-wrapper docutils container" id="lit-3">
<div class="highlight-C++ notranslate"><div class="highlight"><pre><span></span><span class="n">WGPUCommandEncoderDescriptor</span><span class="w"> </span><span class="n">encoderDesc</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="p">{};</span>
<span class="n">encoderDesc</span><span class="p">.</span><span class="n">nextInChain</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="k">nullptr</span><span class="p">;</span>
<span class="n">encoderDesc</span><span class="p">.</span><span class="n">label</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="s">&quot;My</span><span class="w"> </span><span class="s">command</span><span class="w"> </span><span class="s">encoder&quot;</span><span class="p">;</span>
<span class="n">WGPUCommandEncoder</span><span class="w"> </span><span class="n">encoder</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">wgpuDeviceCreateCommandEncoder</span><span class="p">(</span><span class="n">device</span><span class="p">,</span><span class="w"> </span><span class="o">&amp;</span><span class="n">encoderDesc</span><span class="p">);</span>
</pre></div>
</div>
<lit-block-info data="{&quot;name&quot;: &quot;Create Command Encoder&quot;, &quot;permalink&quot;: &quot;#lit-3&quot;, &quot;hidden&quot;: false, &quot;replaced by&quot;: [], &quot;completed in&quot;: [], &quot;prepended in&quot;: [], &quot;patched by&quot;: [], &quot;replacing&quot;: [], &quot;completing&quot;: [], &quot;prepending&quot;: [], &quot;inserted in&quot;: [], &quot;referenced in&quot;: [{&quot;name&quot;: &quot;Test command encoding&quot;, &quot;url&quot;: &quot;#lit-6&quot;, &quot;details&quot;: null}]}"></lit-block-info></div>
<p>We can now use the encoder to write instructions (debug placeholder for now).</p>
<div class="literal-block-wrapper lit-block-wrapper docutils container" id="lit-4">
<div class="highlight-C++ notranslate"><div class="highlight"><pre><span></span><span class="n">wgpuCommandEncoderInsertDebugMarker</span><span class="p">(</span><span class="n">encoder</span><span class="p">,</span><span class="w"> </span><span class="s">&quot;Do</span><span class="w"> </span><span class="s">one</span><span class="w"> </span><span class="s">thing&quot;</span><span class="p">);</span>
<span class="n">wgpuCommandEncoderInsertDebugMarker</span><span class="p">(</span><span class="n">encoder</span><span class="p">,</span><span class="w"> </span><span class="s">&quot;Do</span><span class="w"> </span><span class="s">another</span><span class="w"> </span><span class="s">thing&quot;</span><span class="p">);</span>
</pre></div>
</div>
<lit-block-info data="{&quot;name&quot;: &quot;Add commands&quot;, &quot;permalink&quot;: &quot;#lit-4&quot;, &quot;hidden&quot;: false, &quot;replaced by&quot;: [], &quot;completed in&quot;: [], &quot;prepended in&quot;: [], &quot;patched by&quot;: [], &quot;replacing&quot;: [], &quot;completing&quot;: [], &quot;prepending&quot;: [], &quot;inserted in&quot;: [], &quot;referenced in&quot;: [{&quot;name&quot;: &quot;Test command encoding&quot;, &quot;url&quot;: &quot;#lit-6&quot;, &quot;details&quot;: null}]}"></lit-block-info></div>
<p>And then finally generating the command from the encoder also requires an extra descriptor:</p>
<div class="literal-block-wrapper lit-block-wrapper docutils container" id="lit-5">
<div class="highlight-C++ notranslate"><div class="highlight"><pre><span></span><span class="n">WGPUCommandBufferDescriptor</span><span class="w"> </span><span class="n">cmdBufferDescriptor</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="p">{};</span>
<span class="n">cmdBufferDescriptor</span><span class="p">.</span><span class="n">nextInChain</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="k">nullptr</span><span class="p">;</span>
<span class="n">cmdBufferDescriptor</span><span class="p">.</span><span class="n">label</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="s">&quot;Command</span><span class="w"> </span><span class="s">buffer&quot;</span><span class="p">;</span>
<span class="n">WGPUCommandBuffer</span><span class="w"> </span><span class="n">command</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">wgpuCommandEncoderFinish</span><span class="p">(</span><span class="n">encoder</span><span class="p">,</span><span class="w"> </span><span class="o">&amp;</span><span class="n">cmdBufferDescriptor</span><span class="p">);</span>

<span class="c1">//</span><span class="w"> </span><span class="c1">Finally</span><span class="w"> </span><span class="c1">submit</span><span class="w"> </span><span class="c1">the</span><span class="w"> </span><span class="c1">command</span><span class="w"> </span><span class="c1">queue</span>
<span class="n">std</span><span class="o">::</span><span class="n">cout</span><span class="w"> </span><span class="o">&lt;&lt;</span><span class="w"> </span><span class="s">&quot;Submitting</span><span class="w"> </span><span class="s">command...&quot;</span><span class="w"> </span><span class="o">&lt;&lt;</span><span class="w"> </span><span class="n">std</span><span class="o">::</span><span class="n">endl</span><span class="p">;</span>
<span class="n">wgpuQueueSubmit</span><span class="p">(</span><span class="n">queue</span><span class="p">,</span><span class="w"> </span><span class="mi">1</span><span class="p">,</span><span class="w"> </span><span class="o">&amp;</span><span class="n">command</span><span class="p">);</span>

<span class="cp">#ifdef</span><span class="w"> </span><span class="cp">WEBGPU_BACKEND_DAWN</span>
<span class="n">wgpuCommandEncoderRelease</span><span class="p">(</span><span class="n">encoder</span><span class="p">);</span>
<span class="n">wgpuCommandBufferRelease</span><span class="p">(</span><span class="n">command</span><span class="p">);</span>
<span class="cp">#endif</span>
</pre></div>
</div>
<lit-block-info data="{&quot;name&quot;: &quot;Finish encoding and submit&quot;, &quot;permalink&quot;: &quot;#lit-5&quot;, &quot;hidden&quot;: false, &quot;replaced by&quot;: [], &quot;completed in&quot;: [], &quot;prepended in&quot;: [], &quot;patched by&quot;: [], &quot;replacing&quot;: [], &quot;completing&quot;: [], &quot;prepending&quot;: [], &quot;inserted in&quot;: [], &quot;referenced in&quot;: [{&quot;name&quot;: &quot;Test command encoding&quot;, &quot;url&quot;: &quot;#lit-6&quot;, &quot;details&quot;: null}]}"></lit-block-info></div>
<div class="admonition-implementation-divergence admonition">
<p class="admonition-title">Implementation divergence</p>
<p>In <code class="docutils literal notranslate"><span class="pre">wgpu-native</span></code>, the <code class="docutils literal notranslate"><span class="pre">Finish</span></code> operation also destroys the <code class="docutils literal notranslate"><span class="pre">encoder</span></code>, so there is no need to call <code class="docutils literal notranslate"><span class="pre">wgpuCommandEncoderRelease</span></code>. Similarly the <code class="docutils literal notranslate"><span class="pre">wgpuQueueSubmit</span></code> takes care of destroying the command buffer. <strong>This is likely to change in the future</strong>.</p>
</div>
<div class="literal-block-wrapper lit-block-wrapper lit-block-hidden docutils container" id="lit-6">
<div class="highlight-C++ notranslate"><div class="highlight"><pre><span></span><span class="n"><lit-ref name="Get Queue" href="#lit-0" lexer="C++" hidden-link="false">{{<a href="the-command-queue.html#lit-0">Get Queue</a>}}</lit-ref></span>
<span class="n"><lit-ref name="Add queue callback" href="#lit-1" lexer="C++" hidden-link="false">{{<a href="the-command-queue.html#lit-1">Add queue callback</a>}}</lit-ref></span>
<span class="n"><lit-ref name="Create Command Encoder" href="#lit-3" lexer="C++" hidden-link="false">{{<a href="the-command-queue.html#lit-3">Create Command Encoder</a>}}</lit-ref></span>
<span class="n"><lit-ref name="Add commands" href="#lit-4" lexer="C++" hidden-link="false">{{<a href="the-command-queue.html#lit-4">Add commands</a>}}</lit-ref></span>
<span class="n"><lit-ref name="Finish encoding and submit" href="#lit-5" lexer="C++" hidden-link="false">{{<a href="the-command-queue.html#lit-5">Finish encoding and submit</a>}}</lit-ref></span>
</pre></div>
</div>
<lit-block-info data="{&quot;name&quot;: &quot;Test command encoding&quot;, &quot;permalink&quot;: &quot;#lit-6&quot;, &quot;hidden&quot;: true, &quot;replaced by&quot;: [], &quot;completed in&quot;: [], &quot;prepended in&quot;: [], &quot;patched by&quot;: [], &quot;replacing&quot;: [], &quot;completing&quot;: [], &quot;prepending&quot;: [], &quot;inserted in&quot;: [], &quot;referenced in&quot;: [{&quot;name&quot;: &quot;Create things&quot;, &quot;url&quot;: &quot;#lit-7&quot;, &quot;details&quot;: null}]}"></lit-block-info></div>
<div class="literal-block-wrapper lit-block-wrapper lit-block-hidden docutils container" id="lit-7">
<div class="highlight-C++ notranslate"><div class="highlight"><pre><span></span><span class="n"><lit-ref name="Test command encoding" href="#lit-6" lexer="C++" hidden-link="false">{{<a href="the-command-queue.html#lit-6">Test command encoding</a>}}</lit-ref></span>
</pre></div>
</div>
<lit-block-info data="{&quot;name&quot;: &quot;Create things&quot;, &quot;permalink&quot;: &quot;#lit-7&quot;, &quot;hidden&quot;: true, &quot;replaced by&quot;: [], &quot;completed in&quot;: [], &quot;prepended in&quot;: [], &quot;patched by&quot;: [], &quot;replacing&quot;: [], &quot;completing&quot;: [{&quot;name&quot;: &quot;Create things&quot;, &quot;url&quot;: &quot;the-device.html#lit-9&quot;, &quot;details&quot;: null}], &quot;prepending&quot;: [], &quot;inserted in&quot;: [], &quot;referenced in&quot;: []}"></lit-block-info></div>
<p>This should output:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">Submitting</span> <span class="n">command</span><span class="o">...</span>
<span class="n">Queued</span> <span class="n">work</span> <span class="n">finished</span> <span class="k">with</span> <span class="n">status</span><span class="p">:</span> <span class="mi">0</span>
</pre></div>
</div>
<div class="admonition warning">
<p class="admonition-title">Warning</p>
<p>Again, on <code class="docutils literal notranslate"><span class="pre">wgpu-native</span></code> you will not see the “finished” line. On Dawn, you need to add an extra non-standard argument set to 0 just after <code class="docutils literal notranslate"><span class="pre">queue</span></code>.</p>
</div>
<p>At this stage, the code works, but submits a command queue that is almost empty. So it is a bit hard to be thrilled about, let’s pump it up with some basic buffer manipulation.</p>
</section>
<section id="conclusion">
<h2>Conclusion<a class="headerlink" href="the-command-queue.html#conclusion" title="Permalink to this heading">#</a></h2>
<p>We have seen a few important notions in this chapter:</p>
<ul class="simple">
<li><p>The CPU and GPU live in <strong>different timelines</strong>.</p></li>
<li><p>Commands are streamed from CPU to GPU through a <strong>command queue</strong>.</p></li>
<li><p>Queued command buffers must be encoded using a <strong>command encoder</strong>.</p></li>
</ul>
<p>This was a bit abstract because we can queue operations but we did not see any yet. In the next chapter we use it to <strong>finally display something</strong> in our window!</p>
<p>We will also see in <a class="reference internal" href="../basic-3d-rendering/input-geometry/playing-with-buffers.html"><span class="std std-doc"><em>Playing with buffers</em></span></a> how to use it for GPU-side buffer manipulation.</p>
<p><em>Resulting code:</em> <a class="reference external" href="https://github.com/eliemichel/LearnWebGPU-Code/tree/step017"><code class="docutils literal notranslate"><span class="pre">step017</span></code></a></p>
</section>
</section>

        </article>
      </div>
      <footer>
        
        <div class="related-pages">
          <a class="next-page" href="first-color.html">
              <div class="page-info">
                <div class="context">
                  <span>Next</span>
                </div>
                <div class="title">First Color</div>
              </div>
              <svg class="furo-related-icon"><use href="#svg-arrow-right"></use></svg>
            </a>
          <a class="prev-page" href="the-device.html">
              <svg class="furo-related-icon"><use href="#svg-arrow-right"></use></svg>
              <div class="page-info">
                <div class="context">
                  <span>Previous</span>
                </div>
                
                <div class="title">The Device</div>
                
              </div>
            </a>
        </div>
        <div class="bottom-of-page">
          <div class="left-details">
            <div class="copyright">
                Copyright &#169; 2022-2023, Élie Michel and contributors
            </div>
            Made with <a href="https://www.sphinx-doc.org/">Sphinx</a> and <a class="muted-link" href="https://pradyunsg.me">@pradyunsg</a>'s
            
            <a href="https://github.com/pradyunsg/furo">Furo</a>
            
          </div>
          <div class="right-details">
            <div class="icons">
              <a class="muted-link " href="https://github.com/eliemichel/LearnWebGPU" aria-label="GitHub">
                <svg stroke="currentColor" fill="currentColor" stroke-width="0" viewBox="0 0 16 16">
                    <path fill-rule="evenodd" d="M8 0C3.58 0 0 3.58 0 8c0 3.54 2.29 6.53 5.47 7.59.4.07.55-.17.55-.38 0-.19-.01-.82-.01-1.49-2.01.37-2.53-.49-2.69-.94-.09-.23-.48-.94-.82-1.13-.28-.15-.68-.52-.01-.53.63-.01 1.08.58 1.23.82.72 1.21 1.87.87 2.33.66.07-.52.28-.87.51-1.07-1.78-.2-3.64-.89-3.64-3.95 0-.87.31-1.59.82-2.15-.08-.2-.36-1.02.08-2.12 0 0 .67-.21 2.2.82.64-.18 1.32-.27 2-.27.68 0 1.36.09 2 .27 1.53-1.04 2.2-.82 2.2-.82.44 1.1.16 1.92.08 2.12.51.56.82 1.27.82 2.15 0 3.07-1.87 3.75-3.65 3.95.29.25.54.73.54 1.48 0 1.07-.01 1.93-.01 2.2 0 .21.15.46.55.38A8.013 8.013 0 0 0 16 8c0-4.42-3.58-8-8-8z"></path>
                </svg>
            </a>
              
            </div>
          </div>
        </div>
        
      </footer>
    </div>
    <aside class="toc-drawer">
      <div class="toc-sticky toc-scroll">
	<div class="toc-title-container">
		<span class="toc-title">
			On this page
		</span>
	</div>
	<div class="toc-tree-container">
		<div class="toc-tree">
			<ul>
<li><a class="reference internal" href="the-command-queue.html#">The Command Queue</a><ul>
<li><a class="reference internal" href="the-command-queue.html#different-timelines">Different timelines</a></li>
<li><a class="reference internal" href="the-command-queue.html#queue-operations">Queue operations</a></li>
<li><a class="reference internal" href="the-command-queue.html#submitting-commands">Submitting commands</a></li>
<li><a class="reference internal" href="the-command-queue.html#command-encoder">Command encoder</a></li>
<li><a class="reference internal" href="the-command-queue.html#conclusion">Conclusion</a></li>
</ul>
</li>
</ul>

		</div>
	</div>
	
	<div class="toc-title-container">
		<span class="toc-title">
			Literate options
		</span>
	</div>
	<div class="toc-tree-container">
		<div class="toc-tree">
			
<ul>
	<li>
		<label for="lit-opts-show-block-name">
			<input id="lit-opts-show-block-name" type="checkbox" checked />
			Show block name
		</label>
	</li>
	<li>
		<label for="lit-opts-show-reference-details">
			<input id="lit-opts-show-reference-details" type="checkbox" checked />
			Show reference details
		</label>
	</li>
	<li>
		<label for="lit-opts-show-reference-links">
			<input id="lit-opts-show-reference-links" type="checkbox" checked />
			Highlight links
		</label>
	</li>
	<li>
		<label for="lit-opts-show-hidden-links">
			<input id="lit-opts-show-hidden-links" type="checkbox" checked />
			Show hidden links
		</label>
	</li>
	<li>
		<label for="lit-opts-show-hidden-blocks">
			<input id="lit-opts-show-hidden-blocks" type="checkbox" checked />
			Show hidden blocks
		</label>
	</li>
</ul>

		</div>
	</div>
	
</div>
    </aside>
  </div>
</div><script data-url_root="../" id="documentation_options" src="../_static/documentation_options.js"></script>
    <script src="../_static/jquery.js"></script>
    <script src="../_static/underscore.js"></script>
    <script src="../_static/_sphinx_javascript_frameworks_compat.js"></script>
    <script src="../_static/doctools.js"></script>
    <script src="../_static/sphinx_highlight.js"></script>
    <script src="../_static/scripts/furo.js"></script>
    <script src="../_static/clipboard.min.js"></script>
    <script src="../_static/copybutton.js"></script>
    <script src="../_static/tabs.js"></script>
    <script src="../_static/sphinx_literate.js"></script>
    </body>
</html>